---
title: "R Notebook"
author: "Junsoo Park"
date: "2023-09-02"
output:
  pdf_document: default
  html_notebook: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, echo=FALSE, message=FALSE, results=FALSE)
```

# Chickadee Pathogen Data Statistical Analysis

## TRU 4001 - Biostatistics - Final Project

## Introduction

This is a personal notebook which accompanies the final project for Thompson Rivers University's Biology 4001, Biostatistics taught by Professor Iain Pardoe. The submission is a report which in the style of a research paper in biology.

This notebook includes the task requirements, as well as other statistical techniques which may be useful to carry out and document. The notebook shall serve as a general guideline and template for statistical analyses for future work.

## 1. Problem Definition

### Problem Space

Data from nest boxes at 47 mountain chickadee sites was collected to examine microbial community compositions associated with chickadees in urban, semi-urban, and rural environments. DNA sequencing was used to determine the relative abundance of different microbial taxa present in swabs from either chickadee nests or feathers in nest boxes in these three habitat types. Nest boxes were set up to encourage nesting in the sample sites. For the feather data, physical characteristics of the birds were recorded. The data was also used to determine two different measures of microbial species richness (alpha diversity) at each site.

From the description, it appears that we are interested in microbial community compositions, particularly pathogenic bacteria species, and their relationship with features of mountain chickadees.

### Type of Problem

-   Determine whether the problem is a descriptive study, hypothesis testing, estimation, prediction, etc.

There are various problems in this task, including descriptive studies, hypothesis testing, estimation, and prediction.

### Task/Question/Hypothesis

-   Clearly Define the questions to be answered or the hypotheses to be tested.

-   Make sure all the information needed to answer each question is provided (e.g., for questions that ask you to do a test, state the hypotheses you're testing, the test statistic and p-value obtained from R, the decision based on a significance level of 5%, and the conclusion in the context of the question).

    #### (Graded)

    \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

-   Summarize the data in **`ChickadeeData.csv`** numerically.

-   Summarize the data in **`ChickadeeData.csv`** graphically.

-   Use a two-sample *t*-test to determine whether the mean abundance of bacteria identified as genus *Escherichia/Shigella* differs significantly between nests and feathers. [Consider transforming variable **`EscShi`** and use R function **`t.test`**. Be careful when applying the natural logarithm transformation to data containing zeros since ln(0) is undefined. The usual way around this is to calculate ln(y+1) instead of ln(y).]

-   Use a Mann-Whitney U-test (Wilcoxon rank sum test) to determine whether the population distribution of the abundance of bacteria identified as genus *Escherichia/Shigella* differs significantly between nests and feathers. [Use R function **`wilcox.test`**.]

-   Use a two-sample *t*-test to determine whether the mean abundance of bacteria identified as genus *Enterococcus* differs significantly between nests and feathers. [Consider transforming variable **`Entero`** and use R function **`t.test`**.]

-   Use a Mann-Whitney U-test (Wilcoxon rank sum test) to determine whether the population distribution of the abundance of bacteria identified as genus *Enterococcus* differs significantly between nests and feathers. [Use R function **`wilcox.test`**.]

-   Use analysis of variance to determine whether mean pathogen richness is related to habitat. [Use R functions **`lm`** and **`anova`**.]

-   Use a Kruskal-Wallis test to determine whether mean pathogen richness is related to habitat. [Use R function **`kruskal.test`**.]

-   Use the Tukey-Kramer method to which habitats differ with respect to mean pathogen richness. [Use R functions **`emmeans`** and **`contrast`**.]

-   Use contingency table analysis to determine whether community richness on feathers is independent of mountain chickadees sex? [Use R function **`filter`** in the **`dplyr`** package to subset the data frame to retain only feather swabs, then use R functions **`table`** and **`chisq.test`**.]

-   Use simple linear regression to determine which of **`WingChord`**, **`BirdWeight`**, **`TailLen`**, or **`TarsusLen`** is most linearly associated with pathogen richness on feathers. [Use R functions **`lm`** and **`summary`**.]

-   For the simple linear regression model selected in Question 11, investigate whether there are any outliers. An outlier in the context of linear regression is an observation with an extreme difference between the observed response value and the predicted response value from the model. Use the **`filter`** function to create a new data frame that excludes the most extreme outlier and refit the simple linear regression model. Report the results for the model fit to the data frame excluding the outlier and use this data frame to answer Questions 13-18.

-   Find the best multiple linear regression model for predicting pathogen richness on feathers from two predictors out of **`WingChord`**, **`BirdWeight`**, **`TailLen`**, and **`TarsusLen`**. [Use R functions **`lm`** and **`summary`**.]

-   Use a two-sample *t*-test to determine whether mean pathogen richness on feathers differs significantly between male and female birds. [Use R function **`t.test`**.]

-   Starting from the simple linear regression model in Question 12, use analysis of covariance to investigate whether the linear association in the model differs for male and female birds. [Use R functions **`lm`** and **`summary`**.]

-   Apply principal component analysis to the variables **`WingChord`**, **`BirdWeight`**, **`TailLen`**, and **`TarsusLen`**. [Use R functions **`scale`**, **`prcomp`**, and **`summary`**. Also, summarize the principal component loadings and use R function **`fviz_pca_ind`** with argument **`habillage`** to visualize the results and colour the observations by bird sex.]

-   Fit a simple linear regression model with response variable **`PathRich`** and predictor variable equal to the first principal component from Question 16. Compare this model with the simple linear regression model in Question 12. [Use R functions **`lm`** and **`summary`**.]

-   Fit a multiple linear regression model with response variable **`PathRich`** and predictor variables equal to the first two principal components from Question 16. Compare this model with the multiple linear regression model in Question 13. [Use R functions **`lm`** and **`summary`**.]

-   Apply metric multidimensional scaling (MDS) to the dissimilarities data in the **`ChickadeeDissimilarities.csv`** file. [Use R function **`cmdscale`** to perform the metric MDS and use function **`ggplot`** to create a scatterplot that projects the data onto the first two principal coordinates. Then use the **`shape`** aesthetic to first mark the points by **`Habitat`** and then by **`Source`**.] Does the composition of the microbial communities appear to be related to **`Habitat`** or **`Source`**?

-   Apply nonmetric multidimensional scaling (NMDS) to the dissimilarities data in the **`ChickadeeDissimilarities.csv`** file. [Use R function **`metaMDS`** to perform the NMDS and use function **`ggplot`** to create a scatterplot that projects the data onto the first two NMDS axes. Then use the **`shape`** aesthetic to first mark the points by **`Habitat`** and then by **`Source`**.] Does the composition of the microbial communities appear to be related to **`Habitat`** or **`Source`**?

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

## 2. Data Collection and Preprocessing

### Data Source

-   Identify the sources of data, whether it is from an experiment, survey, existing dataset, etc.

The data in the **`ChickadeeData.csv`** file consist of the following variables:

-   **`Site`** = Name of the site

-   **`Habitat`** = Whether the nest box is in an urban, semi-urban, or rural habitat

-   **`Source`** = Whether the swab was taken from a nest or a feather

-   **`EscShi`** = Abundance of pathogenic bacteria identified as genus *Escherichia/Shigella*

-   **`Entero`** = Abundance of pathogenic bacteria identified as genus *Enterococcus*

-   **`CommRich`** = Categorical measure of alpha diversity equal to "high" if the number of unique bacterial species present in the swab exceeds 400, or equal to "low" otherwise

-   **`PathRich`** = Quantitative measure of alpha diversity equal to the number of unique potentially pathogenic bacteria species present in the swab

-   **`WingChord`** = Measure of bird wing size (for feather swabs only)

-   **`BirdWeight`** = Measure of bird weight (for feather swabs only)

-   **`TailLen`** = Measure of bird tail length (for feather swabs only)

-   **`TarsusLen`** = Measure of bird tarsus length (for feather swabs only)

-   **`BirdSex`** = Sex of the bird (for feather swabs only)

Microbial community composition data for 2607 taxa was also used to calculate Bray Curtis dissimilarities between the 47 sites; these are in the **`ChickadeeDissimilarities.csv`** file.

### Data Cleaning

-   Preprocess the data to handle missing values, outliers, or other anomalies.

As the dataset was provided as an assignment, no preprocessing is required. However, let us do a basic check for null values:

```{r}
# Read the data
chickadeeData <- read.csv("ChickadeeData.csv")
dissimilaritiesData <- read.csv("ChickadeeDissimilarities.csv")

# Check for Missing Data in the Entire Dataset
sum(is.na(chickadeeData))

# Check for Missing Data Column-wise
colSums(is.na(chickadeeData))

# Check for Missing Data Row-wise
rowSums(is.na(chickadeeData))

# Visualizing Missing Data
library(visdat)
vis_miss(chickadeeData)


# Now for dissimilarities data

# Check for Missing Data in the Entire Dataset
sum(is.na(dissimilaritiesData))

# Check for Missing Data Column-wise
colSums(is.na(dissimilaritiesData))

# Check for Missing Data Row-wise
rowSums(is.na(dissimilaritiesData))

# Visualizing Missing Data
vis_miss(dissimilaritiesData)

```

It appears that 15.1% of the chickadee dataset is missing, while there is no null data in the dissimilarities dataset.

For now, we will leave it as we develop a better understanding of the data and the problem.

### Experimental Design Considerations

-   Designing Effective Experiments: consider (a) reducing bias in estimating and testing treatment effects, and (b) reducing the effects of sampling error.

-   Topics in experimental design include randomized controlled trials, control groups, treatment groups, and experimental controls.

-   Reduce bias: Use Simultaneous control group, randomization, and blinding.

-   Reduce the influence of sampling error: Replication, balance, blocking, and extreme treatments.

-   If you can't do experiments: Match and adjust.

-   Sample size: Plan for precision, power, and data loss.

-   A priori tests or analyses.

### Feature Engineering

-   Deriving new variables that might be relevant for analysis.

### Data Transformation

-   Such as normalization, standardization, or logarithmic transformation if required.
-   Generally, scaling is required when: variables are measured in different units, When the algorithm is based on distance or gradient, or for interpretability.

## 3. Exploratory Data Analysis

-   Exploratory Data Analysis (EDA) is an essential step in understanding the data, identifying patterns, spotting anomalies, and developing an intuition about the relationships between variables.

### Data Inspection

-   The first step should be to open and inspect the dataset (even in a spreadsheet). View the first few lines and familiarize yourself with the variable names.

-   A good first goal is to find a plot type that clearly and efficiently visualizes the patterns in the data, especially the differences among groups.

Let us open and inspect the data in excel, to get a first glance. The variables and the data are already described in the assignment.

### Setup

```{r}
# setwd("C:\\Users\\JP\\Desktop\\RECENT\\Biology\\BIOL 4001 - Biostatistics\\Final")
library(ggplot2)
library(dplyr)
library(emmeans)
library(GGally)
library(factoextra)
library(ggrepel)
library(vegan)
library(Hmisc)
library(car)
library(pheatmap)
library(photobiology)
library(ggrepel)
library(reshape2)
library(rgl)
library(vcd)
library(ade4)
library(gridExtra)
theme_set(theme_classic())

```

### Summary Statistics

-   Measures of Central Tendency: Mean, median, and mode.

-   Measures of Spread: Variance, standard deviation, range, interquartile range (IQR).

-   Measures of Shape: Skewness (asymmetry) and kurtosis (tailedness).

-   Percentiles: Quantiles including the quartiles.

-   Correlation: Correlation coefficients to measure linear relationships between variables.

-   Summary Statistics by Group.

-   Summarize the data in **`ChickadeeData.csv`** numerically.

```{r}
# Summarize data
summary(chickadeeData)
head(chickadeeData)

# See column names
names(chickadeeData)

# Check unique values of a specific column
unique(chickadeeData$Source)

# Detailed summary of dataframe
str(chickadeeData)

# Summarize each variable using Hmisc
describe(chickadeeData)

# Use a table to display example categorical variable
chickadeeTableEscShi <- table(chickadeeData$EscShi)
chickadeeTableEscShi

chickadeeTableEntero <- table(chickadeeData$Entero)
chickadeeTableEntero

```

The data consists of 47 observations with 12 variables: Site, Habitat, Source, EscShi, Entero, CommRich, PathRich, WingChord, BirdWeight, TailLen, TarsusLen, and BirdSex. Below are the summary statistics for key variables:

Categorical Variables:

Habitat: 3 types (Rural: 20, Semi-urban: 14, Urban: 13)

Source: 2 types (Feather: 30, Nest: 17)

CommRich: 2 types (High: 19, Low: 28)

BirdSex: 2 types (F: 17, M: 13) [missing: 17]

Numerical Variables:

EscShi: Min: 0, 1st Quartile: 25, Median: 112, Mean: 577.9, 3rd Quartile: 432.5, Max: 6520

Entero: Min: 0, 1st Quartile: 9, Median: 20, Mean: 92.74, 3rd Quartile: 48.5, Max: 687

PathRich: Min: 11, 1st Quartile: 36, Median: 41, Mean: 44.3, 3rd Quartile: 53.5, Max: 88

Variables with Missing Data:

WingChord: 30 non-missing (Min: 60, Median: 65, Max: 69) [missing: 17]

BirdWeight: 30 non-missing (Min: 10, Median: 11, Max: 17) [missing: 17]

TailLen: 30 non-missing (Min: 53, Median: 57, Max: 62) [missing: 17]

TarsusLen: 30 non-missing (Min: 16.8, Median: 18.25, Max: 19.5) [missing: 17]

The data shows a variety of bird habitats and sources, with most coming from feathers. The data also suggests wide variations in the numerical variables, like EscShi and Entero. There are also quite a few missing values for variables related to bird physical features, which should be taken into account in any subsequent analysis.

### Visualizations

-   Histograms: To understand the distribution of a single variable.

-   Scatter Plots: To visualize relationships between two continuous variables.

-   Box Plots: To see the spread and skewness across categories.

-   Heatmaps: For visualizing correlation matrices or two-way frequency tables.

-   Pair Plots: A set of scatter plots for all pairs of variables to see relationships and distributions.

-   Time Series Plots: If the data is a time series, to visualize trends and seasonality.

-   Summarize the data in **`ChickadeeData.csv`** graphically.

```{r}

# Visualize frequency distributions of single variables

# Bar charts for categorical variables

# Habitat
p1 <- ggplot(data = chickadeeData, aes(x = Habitat)) +
geom_bar(stat = "count") +
labs(x = "Habitat", y = "Frequency") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Source
p2 <- ggplot(data = chickadeeData, aes(x = Source)) +
geom_bar(stat = "count") +
labs(x = "Source", y = "Frequency") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))

# CommRich
p3 <- ggplot(data = chickadeeData, aes(x = CommRich)) +
geom_bar(stat = "count") +
labs(x = "Community Richness", y = "Frequency") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))

# BirdSex
p4 <- ggplot(data = chickadeeData, aes(x = BirdSex)) +
geom_bar(stat = "count") +
labs(x = "Sex", y = "Frequency") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Arrange the plots on one or more pages
grid.arrange(p1, p2, p3, p4, ncol = 2) 

# Histograms for numerical variables

# EscShi
p5 <- ggplot(data = chickadeeData, aes(x = EscShi)) +
geom_histogram(col = "black", binwidth = 50,
boundary = 0, closed = "left") +
labs(x = "EscShi", y = "Frequency")

# Entero
p6 <- ggplot(data = chickadeeData, aes(x = Entero)) +
geom_histogram(col = "black", binwidth = 10,
boundary = 0, closed = "left") +
labs(x = "Entero", y = "Frequency")

# PathRich
p7 <- ggplot(data = chickadeeData, aes(x = PathRich)) +
geom_histogram(col = "black", binwidth = 4,
boundary = 0, closed = "left") +
labs(x = "Pathogen Richness", y = "Frequency")

grid.arrange(p5, p6, p7, ncol = 2) 

# WingChord
p8 <- ggplot(data = chickadeeData, aes(x = WingChord)) +
geom_histogram(col = "black", binwidth = 1,
boundary = 0, closed = "left") +
labs(x = "Wing Size", y = "Frequency")

# BirdWeight
p9 <- ggplot(data = chickadeeData, aes(x = BirdWeight)) +
geom_histogram(col = "black", binwidth = 0.5,
boundary = 0, closed = "left") +
labs(x = "Weight", y = "Frequency")

# TailLen
p10 <- ggplot(data = chickadeeData, aes(x = TailLen)) +
geom_histogram(col = "black", binwidth = 1,
boundary = 0, closed = "left") +
labs(x = "Tail Length", y = "Frequency")

# TarsusLen
p11 <- ggplot(data = chickadeeData, aes(x = TarsusLen)) +
geom_histogram(col = "black", binwidth = 0.2,
boundary = 0, closed = "left") +
labs(x = "Tarsus Length", y = "Frequency")

grid.arrange(p8, p9, p10, p11, ncol = 2) 

# Relationship between 2 variables

# Box Plot for numerical variable vs categorical variable
ggplot(chickadeeData, aes(x=BirdSex, y=TarsusLen)) + geom_boxplot()

# Scatter Plots
ggplot(chickadeeData,   
  aes(x = BirdWeight, 
  y = EscShi)) +
  geom_point()

ggplot(chickadeeData,   
  aes(x = TarsusLen, 
  y = PathRich)) +
  geom_point()

# Strip Chart
ggplot (data = chickadeeData, aes(x = WingChord, y = Entero)) +
geom_jitter(shape = 1, size = 2, width = 0.15) +
labs(x = "Wing Size", y = "Entero")

# Violin Plot
ggplot(data = chickadeeData, aes(y = BirdWeight, x = TailLen)) +
geom_violin() +
labs(x = "Tail Length", y = "BirdWeight") +
stat_summary(fun = mean, geom = "point")



```

Upon visual inspeciton, we find that EscShi and Entero distributions are right-skewed, and that pathogen richness, wing size, tail length, and tarsus length are approximately normally distributed.

### Probability (Distributions)

-   Explore and identify the probability distributions of variables, obtain probability mass and density functions.

-   Common Discrete Probability Distributions: Binomial, Discrete Uniform, Poisson.

-   Create probability table for categorical variables.

-   Create probability mass functions (pmf) for discrete probability distributions.

-   Common Continuous Probability Distributions: Normal, Continuous, Log-Normal, Exponential.

-   Create probability density functions (pdf) and/or cumulative density functions (cdf) for continuous probability distributions.

-   You can find the expected value and standard deviation of a probability distribution if you have the formula, sample, or probability table of the distribution (which are used in tests below).

### Dimensionality Reduction

-   Techniques like t-SNE in addition to PCA, MDS or NMDS, especially for visualizing high-dimensional data. Dimensionality reduction reveals the fundamental structure of the data.

-   PCA can help to identify groups of variables which are significant, and helps to reduce noise.

-   Factor Analysis, where the goal is interpretability. FA assumes that there exists an underlying fundamental structure of the data, or underlying latent variables - called "factors" - that influence the observable variables in the data, but are not directly observable themselves.

### Other Techniques

-   Missing Value Analysis: Identifying and analyzing missing data.

-   Outlier Detection: Methods to detect and analyze unusual observations.

-   Categorical Data Analysis: Frequency tables, bar charts, pie charts for categorical variables.

-   Multivariate Analysis: Techniques like Principal Component Analysis (PCA) to understand the relationships among multiple variables.

-   Cross-Tabulations: Also known as contingency tables; useful for understanding the relationship between two categorical variables.

-   Spatial Analysis: If the data has geographical attributes, spatial visualization, and analysis might be essential.

-   Text Analysis: If the dataset contains text, basic text mining techniques might be applicable.

### Initial Tests

-   Normality Tests: Checking if a variable follows a normal distribution.

-   Homogeneity of Variances: Testing if the variances are equal across groups.

### Relationships

-   Correlation: Understand statistical association between variables.

-   Covariance: Understanding how two variables change together.

-   Regression Analysis/Plots: Simple linear regression to visually understand relationships.

-   Effect Size: Understanding the magnitude of relationships between variables.

### Contingency Analysis

-   Association: Understanding if there is an association between the categories of different variables.

-   Independence Testing: Statistical tests like the Chi-Squared Test for Independence can be applied to contingency tables to determine if there is a significant association between the variables.

-   Conditional Probabilities: You can calculate conditional probabilities to understand how the probability of one event changes given the knowledge of another event.

-   Comparison Across Groups: If you have more than two categorical variables, you can explore how the relationship between two variables may differ across the levels of a third variable.

-   Marginal Distribution: You can analyze the marginal distribution of one variable irrespective of the others. This gives insights into the overall distribution of a particular variable.

-   Expected Frequencies: In some cases, you might want to compare observed frequencies in the contingency table with expected frequencies under some statistical model. This can give insights into how well a given model fits your data.

-   Use contingency table analysis to determine whether community richness on feathers is independent of mountain chickadees sex? [Use R function **`filter`** in the **`dplyr`** package to subset the data frame to retain only feather swabs, then use R functions **`table`** and **`chisq.test`**.

```{r}

# Confirm the column to be filtered
unique(chickadeeData$Source)

# Filter df for Source = feather
df_feather <- filter(chickadeeData, Source == 'feather')
df_feather

# Check the order of the categories
chickadeeData$CommRich
unique(chickadeeData$CommRich)
# They are already ordered

# Order the categories as desired by turning into a factor variable (if needed. This is useful for more than 2 categories)
#CommRich_BirdSex_table$CommRich <-
#factor(CommRich_BirdSex_table$CommRich,
#levels = c("low", "high"))

# Create 2x2 Contingency Table for community richness and sex
CommRich_BirdSex_table <- table(df_feather$CommRich, df_feather$BirdSex)
CommRich_BirdSex_table
str(CommRich_BirdSex_table)

# Create a mosaic plot to visualize the data
par(pty = "s") # makes a square plot
mosaicplot(t(CommRich_BirdSex_table), col = c("firebrick", "goldenrod1"),
cex.axis = 1, main = "",
sub = "Infection status", ylab = "Relative frequency")

# Conduct a Chi-squared Test of Independence of Two Categorical Variables
Xsq <- chisq.test(CommRich_BirdSex_table, correct = FALSE)
Xsq
```

In this contingency table analysis using Pearson's Chi-squared test, we assess whether community richness on feathers is independent of the sex of mountain chickadees. The null hypothesis is that community richness and the sex of the bird are independent variables, while the alternative hypothesis is that they are not independent.

According to the test results, the Chi-squared statistic $X^2$ is 1.0325 with 1 degree of freedom, and the p-value is 0.3096. Given that the p-value exceeds the alpha level of 0.05, we fail to reject the null hypothesis.

We conclude that there is insufficient evidence to suggest that community richness on feathers is dependent on the sex of mountain chickadees, based on this data.

## 4. Model Specification

### Statistical Model

-   Choose an appropriate statistical model that aligns with the type of data and research question.

### Estimator

-   Decide on the method of estimation (e.g., Maximum Likelihood, Least Squares, etc.).

### Hyperparameters

-   If you're working with models that require hyperparameter tuning, choose the appropriate values or ranges and methods (like grid search or random search).

## 5. Statistical Inference - Hypothesis Testing (if applicable)

### Null and Alternative Hypotheses

-   Define the hypotheses to be tested.

### Test Statistic

-   Decide on the level of significance (e.g., alpha = 0.05).

### P-value

-   Compute the p-value to determine statistical significance.

### Conclusion

-   Make a decision to accept or reject the null hypothesis based on the p-value.

### Post-Hoc Analysis

-   Tests or Analyses that are performed after the initial hypothesis test to explore the data further, especially when the initial test indicates a significant result.

Note that in R, statistical tests are performed through functions and summarized for you, rather than having to manually implement them (while you can calculate them by hand).

The statistician should handle:

-   The interpretation of the tests. A p-value by itself does not "prove" anything.

-   Underlying assumptions that built-in functions do not automatically check for.

-   Choice of test: ensure that the appropriate test for the data and research question is applied.

-   Data pre-processing: the data must be processed such that the test can be ran on it, handling issues like outliers, missing data, or necessary transformations.

-   Multiple comparisons: generally, research questions will involve comparing the results of multiple tests on the data, and forming an interpretation.

Let us perform the tests of the assignment.

-   Use a two-sample *t*-test to determine whether the mean abundance of bacteria identified as genus *Escherichia/Shigella* differs significantly between nests and feathers. [Consider transforming variable **`EscShi`** and use R function **`t.test`**. Be careful when applying the natural logarithm transformation to data containing zeros since ln(0) is undefined. The usual way around this is to calculate ln(y+1) instead of ln(y).]

As we saw above, EscShi data appears to be Log-normal (having a right-skewed distribution), and could benefit from a natural log transformation. Let us visualize this.

```{r}
# EscShi untransformed
ggplot(data = chickadeeData, aes(x = EscShi)) +
geom_histogram(col = "black", binwidth = 50,
boundary = 0, closed = "left") +
labs(x = "EscShi", y = "Frequency")

# Natural Log transformation + 1 (to handle zeroes)
EscShi_transformed <- log(chickadeeData$EscShi + 1)

# Transformed EscShi histogram
ggplot(data = chickadeeData, aes(x = EscShi_transformed)) +
geom_histogram(col = "black", binwidth = 0.5,
boundary = 0, closed = "left") +
labs(x = "EscShi", y = "Frequency")
```

The transformed data is indeed easier to visualize. From visual inspection, the distribution appears to be approximately normally distributed. Let us assume that the variance within the groups are equal and perform the t-test.

```{r}

# Two sample t-test, assuming equal group variance 
t.test(EscShi ~ Source, data = chickadeeData, var.equal = TRUE)

# Two sample t-test of transformed data, assuming equal group variance
t.test(EscShi_transformed ~ Source, data = chickadeeData, var.equal = TRUE)

```

In the two-sample t-test conducted to determine whether the mean abundance of bacteria identified as genus *Escherichia/Shigella* differs significantly between nests and feathers, our null hypothesis is that the true difference in means between the feather group and the nest group is equal to 0. The alternative hypothesis is that this difference is not equal to 0.

Based on the test results for the natural logarithm-transformed variable, the test statistic *t* is 4.0756, and the p-value is 0.0001842. Given that the p-value is less than the alpha level of 0.05, we reject the null hypothesis.

We conclude that there is a statistically significant difference in the mean abundance of bacteria identified as genus *Escherichia/Shigella* between nests and feathers, based on this data.

-   Use a Mann-Whitney U-test (Wilcoxon rank sum test) to determine whether the population distribution of the abundance of bacteria identified as genus *Escherichia/Shigella* differs significantly between nests and feathers. [Use R function **`wilcox.test`**.]

As we desire to know if the results of the log-normal test would hold to the original population, we will carry out a Mann-Whitney U-test, which can be used in place of the two-sample t-test when the normal distribution assumption of the two-sample t-test cannot be met.

The Mann--Whitney U-test compares the distributions of two groups. It does not require as many assumptions as the two-sample t-test.

Therefore, we will carry it out on the untransformed data.

```{r}

# Mann-Whitney U-Test
wilcox.test(EscShi ~ Source, data = chickadeeData)

```

In the Mann-Whitney U-test (also known as the Wilcoxon rank-sum test) conducted to determine whether the population distribution of the abundance of bacteria identified as genus *Escherichia/Shigella* differs significantly between nests and feathers, our null hypothesis is that the true location shift between the feather group and the nest group is equal to 0. The alternative hypothesis is that this location shift is not equal to 0.

Based on the test results for the untransformed data, the test statistic *W* is 405.5, and the p-value is 0.0008952. Since the p-value is less than the alpha level of 0.05, we reject the null hypothesis.

We conclude that there is statistically significant evidence to suggest that the distributions of abundance for bacteria identified as genus *Escherichia/Shigella* differ between nests and feathers, based on this data.

The Mann-Whitney U-test is useful in this context as it does not require the normal distribution assumption that the two-sample t-test does. Therefore, it allows us to extend our conclusions to the original, untransformed population, providing further evidence for a difference in bacterial abundance between the two groups.

-   Use a two-sample *t*-test to determine whether the mean abundance of bacteria identified as genus *Enterococcus* differs significantly between nests and feathers. [Consider transforming variable **`Entero`** and use R function **`t.test`**.]

We repeat the same procedure for genus *Enterococcus* as we did for genus *Escherichia/Shigella.*

```{r}
# Entero untransformed
ggplot(data = chickadeeData, aes(x = Entero)) +
geom_histogram(col = "black", binwidth = 10,
boundary = 0, closed = "left") +
labs(x = "Entero", y = "Frequency")

# Natural Log transformation + 1 (to handle zeroes)
Entero_transformed <- log(chickadeeData$Entero + 1)

# Transformed Entero histogram
ggplot(data = chickadeeData, aes(x = Entero_transformed)) +
geom_histogram(col = "black", binwidth = 0.5,
boundary = 0, closed = "left") +
labs(x = "Entero", y = "Frequency")

# Two sample t-test of transformed data, assuming equal group variance
t.test(Entero_transformed ~ Source, data = chickadeeData, var.equal = TRUE)

```

In the two-sample t-test conducted to assess whether the mean abundance of bacteria identified as genus *Enterococcus* differs significantly between nests and feathers, our null hypothesis is that the true difference in means between the feather group and the nest group is equal to 0. The alternative hypothesis is that this difference is not equal to 0.

Based on the results of the test on the natural logarithm transformed data, the test statistic *t* is -2.6195, and the p-value is 0.01196. Since the p-value is less than the alpha level of 0.05, we reject the null hypothesis.

We conclude that there is statistically significant evidence to suggest that the mean abundance of bacteria identified as genus *Enterococcus* differs between nests and feathers, based on this data. Additionally, the test indicates that the mean abundance of this bacterial genus is higher in nests compared to feathers.

-   Use a Mann-Whitney U-test (Wilcoxon rank sum test) to determine whether the population distribution of the abundance of bacteria identified as genus *Enterococcus* differs significantly between nests and feathers. [Use R function **`wilcox.test`**.]

```{r}

# Mann-Whitney U-Test
wilcox.test(Entero ~ Source, data = chickadeeData)

```

In the Mann-Whitney U-test to examine whether the population distribution of the abundance of bacteria identified as genus *Enterococcus* varies significantly between nests and feathers, our null hypothesis is that the true location shift between the feather and nest groups is equal to 0. The alternative hypothesis is that this location shift is not equal to 0.

From the test results, the test statistic *W* is 148, and the p-value is 0.01826. Given that the p-value is less than the alpha level of 0.05, we reject the null hypothesis.

We conclude that there is statistically significant evidence to suggest that the population distribution of the abundance of bacteria identified as genus *Enterococcus* differs between nests and feathers. Furthermore, based on this evidence and previous data, we infer that the abundance of *Escherichia/Shigella* is higher in feathers, while the abundance of *Enterococcus* is higher in nests.

-   Use analysis of variance to determine whether mean pathogen richness is related to habitat. [Use R functions **`lm`** and **`anova`**.]

Let us first investigate if mean pathogen richness requires transformation.

```{r}
# Summarize variable
describe(chickadeeData$PathRich)

# PathRich
ggplot(data = chickadeeData, aes(x = PathRich)) +
geom_histogram(col = "black", binwidth = 4,
boundary = 0, closed = "left") +
labs(x = "Pathogen Richness", y = "Frequency")

# Shapiro-Wilk Test for normality
shapiro.test(chickadeeData$PathRich)

```

Upon visual inspection, the pathogen richness data does appear to be normally distributed, and we conclude from the Shapiro-Wilk test that there is do significant difference from a normal distribution. Therefore, we will not transform this data.

Let us perform the analysis of variance:

```{r}
# Scatter Plot with linear model
ggplot(chickadeeData, aes(x=Habitat, y=PathRich)) +
  geom_point(aes(color=Habitat), size=3) +            # Scatter plot
  geom_smooth(method='lm', aes(group=1, color=Habitat)) + # Add a linear fit, colored by Habitat
  labs(title="Relationship between Pathogen Richness and Habitat",
       x="Habitat",
       y="Pathogen Richness") +
  theme_minimal()

```

Upon visual inspection of the linear model, discounting outliers, there does appear to be a linear relationship between pathogen richness and habitat, if we order from rural to urban.

```{r}

# Simple Linear Regression
PathRich_Habitat_Regression <- lm(PathRich ~ Habitat, data = chickadeeData)
summary(PathRich_Habitat_Regression)

# Calculate a 95% Confidence interval for the slope
# confint(PathRich_Habitat_Regression, level = 0.95)

# ANOVA
anova(PathRich_Habitat_Regression)
```

ANOVA essentially tests whether the model, as a whole, explains a significant amount of the variance in the dependent variable.

In this analysis of variance (ANOVA), we assess whether the mean pathogen richness is significantly related to habitat. The null hypothesis is that there is no relationship between habitat and pathogen richness, while the alternative hypothesis is that such a relationship does exist.

According to the linear model results, the F-statistic is 5.275 with a corresponding p-value of 0.008844. Given that this p-value is below the alpha level of 0.05, we reject the null hypothesis.

The model shows statistically significant coefficients for both semi-urban and urban habitats, with p-values of 0.04777 and 0.00305 respectively. This suggests that the type of habitat is a meaningful predictor of pathogen richness.

The Multiple $R^2$ value of 0.1934 indicates that approximately 19.34% of the variability in pathogen richness is explained by habitat. While statistically significant, the model accounts for less than one-fifth of the variance, suggesting that other factors may also be influential.

We conclude that habitat is a statistically significant predictor of pathogen richness, although it explains only a limited portion of the variability. The trend in the estimates of coefficients implies that pathogen richness tends to increase in more densely populated human environments, such as semi-urban and urban areas, based on this data.

-   Use a Kruskal-Wallis test to determine whether mean pathogen richness is related to habitat. [Use R function **`kruskal.test`**.]

```{r}

# Kruskal-Wallis Test
kruskal.test(PathRich ~ Habitat, data = chickadeeData)

```

The Kruskal-Wallis test is a non-parametric alternative to single factor ANOVA, and is used to test if there are statistically significant differences between the medians of three or more independent groups. Unlike ANOVA, it does not assume a normal distribution of the residuals or homogeneity of variance.

We assess whether mean pathogen richness varies significantly across different habitats. The null hypothesis is that there are no differences in mean pathogen richness across habitats, while the alternative hypothesis is that at least one habitat exhibits a difference in mean pathogen richness.

The Kruskal-Wallis $X^2$ test statistic is 13.587, with 2 degrees of freedom, and a p-value of 0.001121. Given that the p-value is well below the alpha level of 0.05, we reject the null hypothesis.

We conclude that there is a statistically significant difference in mean pathogen richness across habitats, based on this data. This evidence aligns with the findings from the linear model, supporting the significance of habitat as a factor influencing pathogen richness.

-   Use the Tukey-Kramer method to which habitats differ with respect to mean pathogen richness. [Use R functions **`emmeans`** and **`contrast`**.]

```{r}

# Tukey-Kramer test
# Often used as a post-hoc analysis after a one-way ANOVA or Kruskal-Wallis test to determine which specific groups differ from each other.
pathogenPairs <- emmeans(PathRich_Habitat_Regression, specs = "Habitat")
pathogenUnplanned <- contrast(pathogenPairs, method = "pairwise",
adjust = "tukey")

pathogenUnplanned
```

In the Tukey-Kramer post-hoc test, we assess which specific habitats differ significantly in terms of mean pathogen richness. The test provides pairwise comparisons between the three habitat types: rural, semi-urban, and urban.

-   Rural vs. Semi-Urban: The estimated mean difference is -9.06, with a p-value of 0.1155. Since this p-value exceeds the alpha level of 0.05, the difference in pathogen richness between rural and semi-urban habitats is not statistically significant.

-   Rural vs. Urban: The estimated mean difference is -14.27, with a p-value of 0.0084. This p-value is less than the alpha level of 0.05, indicating a statistically significant difference in pathogen richness between rural and urban habitats.

-   Semi-Urban vs. Urban: The estimated mean difference is -5.21, with a p-value of 0.5445. As this p-value is greater than 0.05, the difference in pathogen richness between semi-urban and urban habitats is not statistically significant.

Based on the Tukey-Kramer test, we can conclude that pathogen richness is significantly higher in urban areas compared to rural areas. However, no statistically significant differences in pathogen richness were found between rural and semi-urban habitats, or between semi-urban and urban habitats. These findings are consistent with those from the linear regression model and the Kruskal-Wallis test, further substantiating the influence of habitat on pathogen richness.

-   Use simple linear regression to determine which of **`WingChord`**, **`BirdWeight`**, **`TailLen`**, or **`TarsusLen`** is most linearly associated with pathogen richness on feathers. [Use R functions **`lm`** and **`summary`**.]

```{r}

# Select the subset df for feathers
summary(df_feather)
unique(df_feather)

# Fit a linear model to each relationship
fit_WingChord <- lm(df_feather$PathRich ~ df_feather$WingChord)
fit_BirdWeight <- lm(df_feather$PathRich ~ df_feather$BirdWeight)
fit_TailLen <- lm(df_feather$PathRich ~ df_feather$TailLen)
fit_TarsusLen <- lm(df_feather$PathRich ~ df_feather$TarsusLen)

# Summarize the fits
summary(fit_WingChord)
summary(fit_BirdWeight)
summary(fit_TailLen)
summary(fit_TarsusLen)

# Alternatively, fit a multiple linear regression model
fit_all <- lm(PathRich ~ WingChord + BirdWeight + TailLen + TarsusLen, data = df_feather)
summary(fit_all)

```

In this analysis, simple linear regression was used to examine the linear relationship between four bird features (Wing Chord, Bird Weight, Tail Length, and Tarsus Length) and pathogen richness on feathers. Additionally, multiple linear regression was conducted to examine the combined effect of these predictors.

-   Wing Chord: With an $R^2$ of 0.0344 and a p-value of 0.3262, Wing Chord is not a statistically significant predictor of pathogen richness.

-   Bird Weight: Similarly, Bird Weight shows a low $R^2$ of 0.0130 and a high p-value of 0.5492, indicating it is also not a statistically significant predictor.

-   Tail Length: Among the features, Tail Length had the highest $R^2$ value of 0.1139 and the lowest p-value of 0.0682, which approaches significance. While not statistically significant at the alpha = 0.05 level, this variable shows the most promise as a predictor among those tested.

-   Tarsus Length: With an $R^2$ value of 0.0587 and a p-value of 0.1971, Tarsus Length was also not found to be a statistically significant predictor but does have a negative relationship with pathogen richness.

None of the single predictors are statistically significant based on their p-values exceeding the alpha level of 0.05.

The multiple regression model yielded a p-value of 0.3015 and an $R^2$ of 0.1708, indicating that collectively, the predictors are not statistically significant at explaining the variability in pathogen richness. The multiple regression model also failed to reach statistical significance, supporting the null hypothesis that none of these predictors significantly influence pathogen richness on feathers.

-   For the simple linear regression model selected in Question 11, investigate whether there are any outliers. An outlier in the context of linear regression is an observation with an extreme difference between the observed response value and the predicted response value from the model. Use the **`filter`** function to create a new data frame that excludes the most extreme outlier and refit the simple linear regression model. Report the results for the model fit to the data frame excluding the outlier and use this data frame to answer Questions 13-18.

We will now account for outliers in the data:

```{r}

# Investigate outliers visually

# Individually
boxplot(df_feather$PathRich) # Outlier > 60
boxplot(df_feather$WingChord)
boxplot(df_feather$BirdWeight) # Outliers > 13
boxplot(df_feather$TailLen)
boxplot(df_feather$TarsusLen)

```

We can see some outliers in PathRich and BirdWeight, based on falling outside of the interquartile range in the boxplots. Let us filter them, then plot the filtered data:

```{r}

# Filter outliers
df_feather <- filter(df_feather, PathRich < 66) # Outlier > 60
df_feather <- filter(df_feather, BirdWeight < 14) # Outlier > 13

# Check if filters were successful
boxplot(df_feather$PathRich) # Outlier > 60
boxplot(df_feather$BirdWeight) # Outliers > 13

# Check Relationships for more potential outliers
plot(PathRich ~ WingChord, data = df_feather)
plot(PathRich ~ BirdWeight, data = df_feather)
plot(PathRich ~ TailLen, data = df_feather)
plot(PathRich ~ TarsusLen, data = df_feather)

# BirdWeight only has 1 value at 13, treat it as an outlier
df_feather <- filter(df_feather, BirdWeight < 12.5)
plot(PathRich ~ BirdWeight, data = df_feather)

```

After removing the outliers, let us fit the linear model once again:

```{r}

# Fit a linear model to each relationship
fit_WingChord <- lm(df_feather$PathRich ~ df_feather$WingChord)
fit_BirdWeight <- lm(df_feather$PathRich ~ df_feather$BirdWeight)
fit_TailLen <- lm(df_feather$PathRich ~ df_feather$TailLen)
fit_TarsusLen <- lm(df_feather$PathRich ~ df_feather$TarsusLen)

# Summarize the fits
summary(fit_WingChord)
summary(fit_BirdWeight)
summary(fit_TailLen)
summary(fit_TarsusLen)

# Alternatively, fit a multiple linear regression model
fit_all <- lm(PathRich ~ WingChord + BirdWeight + TailLen + TarsusLen, data = df_feather)
summary(fit_all)
```

After identifying and removing the most extreme outliers from our dataset, we refit our simple linear regression models and found that two predictor variables remained statistically significant.

-   Wing Chord: The model estimates a coefficient of 2.2607 for Wing Chord, with a p-value of 0.0301, which is significant at the 0.05 level. The Multiple $R^2$ value for this model is 0.2141.

-   Tail Length: The model estimates a coefficient of 2.1883 for Tail Length, with a p-value of 0.0307, also significant at the 0.05 level. The Multiple $R^2$ value for this model is 0.2128.

When we used all four predictors in a multiple linear regression model, the overall model was significant with a p-value of 0.006673, and a Multiple $R^2$ value of 0.5476. This suggests that our model explains approximately 54.76% of the variability in the response variable, which is a substantial improvement from the individual models.

Therefore, after excluding the most extreme outliers, we can reject the null hypothesis that the predictors have no effect on the response variable for both the individual and multiple regression models. We conclude that there exists at least one predictor that has a statistically significant effect on the response variable.

-   Find the best multiple linear regression model for predicting pathogen richness on feathers from two predictors out of **`WingChord`**, **`BirdWeight`**, **`TailLen`**, and **`TarsusLen`**. [Use R functions **`lm`** and **`summary`**.]

```{r}

# WingChord + BirdWeight
fit_WingChord_BirdWeight <- lm(PathRich ~ WingChord + BirdWeight, data = df_feather)
summary(fit_WingChord_BirdWeight)

# WingChord + TailLen
fit_WingChord_TailLen <- lm(PathRich ~ WingChord + TailLen, data = df_feather)
summary(fit_WingChord_TailLen)

# WingChord + TarsusLen
fit_WingChord_TarsusLen <- lm(PathRich ~ WingChord + TarsusLen, data = df_feather)
summary(fit_WingChord_TarsusLen)

# BirdWeight + TailLen
fit_BirdWeight_TailLen <- lm(PathRich ~ BirdWeight + TailLen, data = df_feather)
summary(fit_BirdWeight_TailLen)

# BirdWeight + TarsusLen
fit_BirdWeight_TarsusLen <- lm(PathRich ~ BirdWeight + TarsusLen, data = df_feather)
summary(fit_BirdWeight_TarsusLen)

# TailLen + TarsusLen
fit_TailLen_TarsusLen <- lm(PathRich ~ TailLen + TarsusLen, data = df_feather)
summary(fit_TailLen_TarsusLen)

```

To identify the best multiple linear regression model for predicting pathogen richness on feathers from two predictors among Wing Chord, Bird Weight, Tail Length, and Tarsus Length, we evaluated several models based on their p-values, Multiple $R^2$, Adjusted $R^2$, and Residual Standard Error (RSE).

Based on these criteria, three models emerged as significant:

Wing Chord + Tarsus Length Model:

P-value: 0.000625 (Significant)

Multiple $R^2$: 0.54

Adjusted $R^2$: 0.4916

RSE: 7.946

Bird Weight + Tarsus Length Model:

P-value: 0.04415 (Significant)

Multiple $R^2$: 0.2799

Adjusted $R^2$: 0.2042

RSE: 9.941

Tail Length + Tarsus Length Model

P-value: 0.003174 (Significant)

Multiple $R^2$: 0.4542

Adjusted $R^2$: 0.3968

RSE: 8.655

The model that includes Wing Chord and Tarsus Length as predictors stands out as the best model based on all the criteria we considered. It not only has the lowest p-value but also the highest Multiple $R^2$ and Adjusted $R^2$ values, along with the lowest RSE. This suggests that the model is both statistically significant and explains a substantial portion of the variance in pathogen richness.

This finding is consistent with our single linear regression analysis, which also identified Wing Chord as a significant predictor. Although Tail Length was identified as a significant predictor in the single linear regression, the multiple regression analysis showed that a model including Wing Chord and Tarsus Lenth is superior based on our evaluation criteria.

-   Use a two-sample *t*-test to determine whether mean pathogen richness on feathers differs significantly between male and female birds. [Use R function **`t.test`**.]

```{r}

# Two-sample t-test
# Determine whether the mean of the dependent variable differs significantly between the independent variables, i.e. compare the means of two groups to see if they are statistically different.

# Assess normality and equal variance
ggplot(df_feather, aes(x = PathRich)) +
geom_histogram(col = "black", binwidth = 3,
boundary = 0, closed = "left") +
facet_wrap( ~ BirdSex, ncol = 1, scales = "free_y") +
labs(x = "Pathogen richness", y = "Sex")

# Q-Q Plot (Quantile-Quantile Plot)
qqnorm(df_feather$PathRich)
qqline(df_feather$PathRich)

# Levene's Test to check for equal variance
leveneTest(df_feather$PathRich ~ df_feather$BirdSex) # fail to reject the null hypothesis, suggesting it is reasonable to assume equal variances.

# Check for missing values
sum(is.na(df_feather$PathRich)) # none

# Filter missing values (if there are any)
#featherSub <- filter(df_feather, PathRich != "NA")

# t-test assuming equal variance
t.test(PathRich ~ BirdSex, data = df_feather, var.equal = TRUE)

```

In this study, we assessed whether there is a significant difference in the mean pathogen richness on feathers between male and female birds. To do so, we used a two-sample *t*-test. The null hypothesis is that there is no significant difference between the means, while the alternative hypothesis asserts otherwise. Our analysis yielded the *t*-value of -1.5165 with 20 degrees of freedom, and a p-value of 0.1451. We find that the p-value exceeds the alpha level of 0.05. Thus, there is insufficient evidence to reject the null hypothesis. We conclude that there is no statistically significant difference in the mean pathogen richness on feathers between male and female birds based on this data.

-   Starting from the simple linear regression model in Question 12, use analysis of covariance to investigate whether the linear association in the model differs for male and female birds. [Use R functions **`lm`** and **`summary`**.]

```{r}

# ANCOVA

# Wing Chord

# Scatterplot by Sex
ggplot(df_feather, aes(WingChord, PathRich, shape = BirdSex)) +
geom_point(size = 2) +
scale_shape_manual(values = c(16, 1)) +
labs(x = "Wing Chord", y = "Pathogen Richness")

# Fit the main effects model (with no interaction term)
featherNoInteractModel <- lm(PathRich ~ WingChord + BirdSex,
data = df_feather)
df_feather$fit0 <- predict(featherNoInteractModel)
ggplot(df_feather, aes(WingChord, PathRich, colour = BirdSex,
shape = BirdSex, linetype=BirdSex)) +
geom_line(aes(y = fit0), size = 1, color = "black") +
geom_point(size = 2) +
scale_colour_manual(values = c("black", "black")) +
scale_shape_manual(values = c(16, 1)) +
labs(x = "Wing Chord", y = "Pathogen Richness")

summary(featherNoInteractModel)

# Fit the interaction model
featherInteractModel <- lm(PathRich ~ WingChord * BirdSex,
data = df_feather)
ggplot(df_feather, aes(WingChord, PathRich, colour = BirdSex,
shape = BirdSex, linetype=BirdSex)) +
geom_smooth(method = "lm", size = 1, se = FALSE, col = "black") +
geom_point(size = 2) +
scale_colour_manual(values = c("black", "black")) +
scale_shape_manual(values = c(16, 1)) +
labs(x = "Wing Chord", y = "Pathogen Richness")

summary(featherInteractModel)

# ANOVA table
anova(featherNoInteractModel, featherInteractModel)
# No significant difference

# Tail Length
# Scatterplot by Sex
ggplot(df_feather, aes(TailLen, PathRich, shape = BirdSex)) +
geom_point(size = 2) +
scale_shape_manual(values = c(16, 1)) +
labs(x = "Tail Length", y = "Pathogen Richness")

# Fit the main effects model (with no interaction term)
featherNoInteractModel <- lm(PathRich ~ TailLen + BirdSex,
data = df_feather)
df_feather$fit0 <- predict(featherNoInteractModel)
ggplot(df_feather, aes(TailLen, PathRich, colour = BirdSex,
shape = BirdSex, linetype=BirdSex)) +
geom_line(aes(y = fit0), size = 1, color = "black") +
geom_point(size = 2) +
scale_colour_manual(values = c("black", "black")) +
scale_shape_manual(values = c(16, 1)) +
labs(x = "Tail Length", y = "Pathogen Richness")

summary(featherNoInteractModel)

# Fit the interaction model
featherInteractModel <- lm(PathRich ~ TailLen * BirdSex,
data = df_feather)
ggplot(df_feather, aes(TailLen, PathRich, colour = BirdSex,
shape = BirdSex, linetype=BirdSex)) +
geom_smooth(method = "lm", size = 1, se = FALSE, col = "black") +
geom_point(size = 2) +
scale_colour_manual(values = c("black", "black")) +
scale_shape_manual(values = c(16, 1)) +
labs(x = "Tail Length", y = "Pathogen Richness")

summary(featherInteractModel)

# ANOVA table
anova(featherNoInteractModel, featherInteractModel)
# No significant difference


```

Based on the results of the ANCOVA tests, we fail to reject the null hypothesis that there is no difference in the models, and conclude that there is no reason to assume statistically significant differences in linear association between bird sexes.

Let us now perform some multivariate methods on the original dataset (feather and nest group) of the pathogen groups:

```{r}

# Correlation matrix

# Select only numeric columns
numeric_data <- select_if(chickadeeData, is.numeric)

# Calculate the correlation matrix
cor_matrix <- cor(numeric_data)
print(cor_matrix)

# Pick column pairs

# Scatter plot matrix (pairs)
ggpairs(chickadeeData[, c("EscShi", "Entero")], axisLabels = "none") +
theme_bw()

# Clustered Heatmap of Correlations between variables
numeric_variables <- chickadeeData[, c("EscShi", "Entero", "PathRich")]
pheatmap(cor(numeric_variables), cell.width = 10, cell.height = 10)

# Centering and Scaling the Data
apply(numeric_data, 2, mean)
apply(numeric_data, 2, sd)
scaledBirds <- scale(numeric_data)
apply(numeric_data, 2, mean)
apply(numeric_data, 2, sd)

# Display in scatterplot marked by sex
ggplot(data.frame(scaledBirds, sex = chickadeeData$BirdSex),
aes(x = EscShi, y = Entero, group = sex)) +
geom_point(aes(color = sex), size = 3)


```

In this study, we used analysis of covariance to investigate whether the linear association in the model differs for male and female birds.

For the model focusing on Wing Chord and Bird Sex, the p-value for the effect of Bird Sex was 0.771, suggesting no significant difference between sexes. Additionally, an interaction term between Wing Chord and Bird Sex was added to the model, resulting in an F-statistic of 0.0179 and an associated p-value of 0.895. Both of these p-values are above the 0.05 significance level, indicating no significant interaction. Similarly, in the model that incorporated Tail Length and BirdSex, the p-value for the Bird Sex effect was 0.5282. When the interaction term between Tail Length and Bird Sex was considered, it yielded an F-statistic of 0.7468 and a p-value of 0.399, both of which also exceed the 0.05 significance level. In both cases, the Analysis of Variance tables suggested that including the interaction term did not significantly improve the fit of the models, as evidenced by their respective p-values of 0.895 and 0.3989.

Given these findings, there is insufficient evidence to reject the null hypothesis, which is that there is no difference in the linear associations between pathogen richness and either Wing Chord or Tail Length, for male and female birds. Therefore, we conclude that the linear associations do not significantly differ between sexes in this dataset.

-   Apply principal component analysis to the variables **`WingChord`**, **`BirdWeight`**, **`TailLen`**, and **`TarsusLen`**. [Use R functions **`scale`**, **`prcomp`**, and **`summary`**. Also, summarize the principal component loadings and use R function **`fviz_pca_ind`** with argument **`habillage`** to visualize the results and colour the observations by bird sex.]

```{r}

# Quick PCA

# Gather the numeric variables
numeric_variables <- chickadeeData[, c("WingChord", "BirdWeight", "TailLen", "TarsusLen")]

scaledBirds <- data.frame(scale(numeric_variables))

ggplot(scaledBirds, aes(x = WingChord, y = BirdWeight)) +
geom_point(size = 2, shape = 21) +
geom_point(aes(y = 0), colour = "red") +
geom_segment(aes(xend = WingChord, yend = 0),
colour = "red",
arrow = arrow(length = unit(0.15, "cm")))

scaledBirds_clean_rows <- na.omit(scaledBirds)
# clustered heatmap of correlations
pheatmap(cor(scaledBirds_clean_rows), treeheight_row = 0.2)

# Perform PCA
pca_result <- prcomp(scaledBirds_clean_rows, center = TRUE, scale. = TRUE) 
# center and scale. are usually TRUE for standardized data, but since the data is already scaled, they are not strictly necessary

summary_pca <- summary(pca_result)
print(summary_pca)

# Explain the first 2 principal components (rotation matrix)
pca_result$rotation[, 1:2]

pca_result$sdev # standard deviations
pca_result$sdev^2 # eigenvalues/variances
pca_result$sdev^2 / sum(pca_result$sdev^2) # proportion of variance

get_eig(pca_result) # eigenvalues/variances
fviz_eig(pca_result, geom = "bar", bar_width = 0.4) +
ggtitle("")

# Scree Plot
fviz_eig(pca_result, addlabels = TRUE)

# Biplot of attributes
fviz_pca_var(pca_result, col.var = "black")

# Contribution of each variable
fviz_cos2(pca_result, choice = "var", axes = 1:2)

# Biplot combined with cos2
fviz_pca_var(pca_result, col.var = "cos2",
            gradient.cols = c("black", "orange", "green"),
            repel = TRUE)

# PCA Scatter Plot
chickadee_clean_rows <- na.omit(chickadeeData) # we need to ensure the rows are equal from the dataset not used in the pca

fviz_pca_ind(pca_result, habillage = chickadee_clean_rows$BirdSex,
geom = "point") +
ggtitle("") +
ylim(c(-6.5,7.5)) +
coord_fixed()

# PCA BiPlot
fviz_pca_biplot(pca_result, geom = "point",
habillage = chickadee_clean_rows$BirdSex,
col.var = "violet", addEllipses = TRUE,
ellipse.level = 0.69) +
ggtitle("") +
ylim(c(-4,5)) +
coord_fixed()


```

From the biplot of the variables with respect to the principal components, we can observe that the female group is lower in both dimensions, compared to the male group. We see that Tarsus length is least correlated to the other variables, while the other three are positively correlated to each other. Furthermore, we observe that tarsus length, wing chord, and tail length are the top contributors to the principal components.

Let us perform the principal component analysis for the feather group only:

```{r}

# Quick PCA

# Gather the numeric variables
numeric_variables <- df_feather[, c("WingChord", "BirdWeight", "TailLen", "TarsusLen")]

scaledBirds <- data.frame(scale(numeric_variables))

ggplot(scaledBirds, aes(x = WingChord, y = BirdWeight)) +
geom_point(size = 2, shape = 21) +
geom_point(aes(y = 0), colour = "red") +
geom_segment(aes(xend = WingChord, yend = 0),
colour = "red",
arrow = arrow(length = unit(0.15, "cm")))

scaledBirds_clean_rows <- na.omit(scaledBirds)
# clustered heatmap of correlations
pheatmap(cor(scaledBirds_clean_rows), treeheight_row = 0.2)

# Perform PCA
pca_result <- prcomp(scaledBirds_clean_rows, center = TRUE, scale. = TRUE) 
# center and scale. are usually TRUE for standardized data, but since the data is already scaled, they are not strictly necessary

summary_pca <- summary(pca_result)
print(summary_pca)

# Explain the first 2 principal components (rotation matrix)
pca_result$rotation[, 1:2]

pca_result$sdev # standard deviations
pca_result$sdev^2 # eigenvalues/variances
pca_result$sdev^2 / sum(pca_result$sdev^2) # proportion of variance

get_eig(pca_result) # eigenvalues/variances
fviz_eig(pca_result, geom = "bar", bar_width = 0.4) +
ggtitle("")

# Scree Plot
fviz_eig(pca_result, addlabels = TRUE)

# Biplot of attributes
fviz_pca_var(pca_result, col.var = "black")

# Contribution of each variable
fviz_cos2(pca_result, choice = "var", axes = 1:2)

# Biplot combined with cos2
fviz_pca_var(pca_result, col.var = "cos2",
            gradient.cols = c("black", "orange", "green"),
            repel = TRUE)

# PCA Scatter Plot
chickadee_clean_rows <- na.omit(df_feather) # we need to ensure the rows are equal from the dataset not used in the pca

fviz_pca_ind(pca_result, habillage = chickadee_clean_rows$BirdSex,
geom = "point") +
ggtitle("") +
ylim(c(-6.5,7.5)) +
coord_fixed()

# PCA BiPlot
fviz_pca_biplot(pca_result, geom = "point",
habillage = chickadee_clean_rows$BirdSex,
col.var = "violet", addEllipses = TRUE,
ellipse.level = 0.69) +
ggtitle("") +
ylim(c(-4,5)) +
coord_fixed()
```

In this study, Principal Component Analysis (PCA) was applied to four variables: Wing Chord, Bird Weight, Tail Len, and Tarsus Length. The first principal component (PC1) accounted for approximately 62.88% of the total variance, with a standard deviation of 1.586. The second principal component (PC2) accounted for 21.31% of the variance, having a standard deviation of 0.923. Together, these two components captured 84.19% of the total variance in the data.

The biplot revealed that the female group was generally lower on both PC1 and PC2 as compared to the male group. The variables Wing Chord, Tail Length, and Bird Weight are positively correlated to each other.

In summary, the PCA indicates that Wing Chord, Bird Weight, and Tail Length are the major contributors to the first principal component and are positively correlated with each other. Tarsus Length, however, exhibits different behavior, especially in its significant contribution to the second principal component.

-   Fit a simple linear regression model with response variable **`PathRich`** and predictor variable equal to the first principal component from Question 16. Compare this model with the simple linear regression model in Question 12. [Use R functions **`lm`** and **`summary`**.]

```{r}

# Extract the principal component scores
pc1_scores <- pca_result$x[, 1]
pc2_scores <- pca_result$x[, 2]

# Fit a linear model to each relationship
fit_PC1 <- lm(chickadee_clean_rows$PathRich ~ pc1_scores)

# Make predictions using the linear model
chickadee_clean_rows$pc1_predicted <- predict(fit_PC1, newdata = chickadee_clean_rows)

# Scatterplot by Sex
ggplot(chickadee_clean_rows, aes(x = pc1_scores, y = PathRich)) +
  geom_point(aes(shape = BirdSex, color = BirdSex), size = 2) + 
  scale_shape_manual(values = c(16, 1)) +
  geom_line(aes(y = pc1_predicted), size = 1, color = "black") + 
  labs(x = "Dimension 1", y = "Pathogen Richness") +
  scale_colour_manual(values = c("red", "blue"))


# Make predictions using the previous simple linear model
fit_WingChord_cleaned <- lm(chickadee_clean_rows$PathRich ~ chickadee_clean_rows$WingChord)
chickadee_clean_rows$predicted_WingChord <- predict(fit_WingChord_cleaned, newdata = chickadee_clean_rows)

# Scatterplot by Sex with both models (along Dimension 1)
ggplot(chickadee_clean_rows, aes(x = pc1_scores, y = PathRich)) +
  geom_point(aes(shape = BirdSex, color = BirdSex), size = 2) + 
  scale_shape_manual(values = c(16, 1)) +
  geom_line(aes(y = pc1_predicted), size = 1, color = "black") + 
    geom_line(aes(x = pc1_scores, y = predicted_WingChord), size = 1, color = "orange", linetype = "dashed") +
  labs(x = "Dimension 1", y = "Pathogen Richness") +
  scale_colour_manual(values = c("red", "blue"))

# Summarize the fits
summary(fit_PC1)
summary(fit_WingChord_cleaned)
summary(fit_WingChord)

```

The linear model using the first principal component does not prove to be significant in this case, with the entire dataset. As we are would like to compare the linear model using principal components against the linear model of the feather group, let us do the same for the feather group:

```{r}

# Extract the principal component scores
pc1_scores <- pca_result$x[, 1]
pc2_scores <- pca_result$x[, 2]

# Fit a linear model to each relationship
fit_PC1 <- lm(chickadee_clean_rows$PathRich ~ pc1_scores)

# Make predictions using the linear model
chickadee_clean_rows$pc1_predicted <- predict(fit_PC1, newdata = chickadee_clean_rows)

# Scatterplot by Sex
ggplot(chickadee_clean_rows, aes(x = pc1_scores, y = PathRich)) +
  geom_point(aes(shape = BirdSex, color = BirdSex), size = 2) + 
  scale_shape_manual(values = c(16, 1)) +
  geom_line(aes(y = pc1_predicted), size = 1, color = "black") + 
  labs(x = "Dimension 1", y = "Pathogen Richness") +
  scale_colour_manual(values = c("red", "blue"))


# Make predictions using the previous simple linear model
fit_WingChord_cleaned <- lm(chickadee_clean_rows$PathRich ~ chickadee_clean_rows$WingChord)
chickadee_clean_rows$predicted_WingChord <- predict(fit_WingChord_cleaned, newdata = chickadee_clean_rows)

# Scatterplot by Sex with both models (along Dimension 1)
ggplot(chickadee_clean_rows, aes(x = pc1_scores, y = PathRich)) +
  geom_point(aes(shape = BirdSex, color = BirdSex), size = 2) + 
  scale_shape_manual(values = c(16, 1)) +
  geom_line(aes(y = pc1_predicted), size = 1, color = "black") + 
    geom_line(aes(x = pc1_scores, y = predicted_WingChord), size = 1, color = "orange", linetype = "dashed") +
  labs(x = "Dimension 1", y = "Pathogen Richness") +
  scale_colour_manual(values = c("red", "blue"))

# Summarize the fits
summary(fit_PC1)
summary(fit_WingChord_cleaned)
summary(fit_WingChord)


```

In this study, we fit a a simple linear regression model with Pathogen Richness as a response variable and predictor variable equal to the first principal component, and compared it to the simple linear regression model with Wing Chord as a predictor. In the first model, where Pathogen Richness is predicted by PC1, the coefficient for PC1 is 2.099, with a standard error of 1.499, resulting in a t-value of 1.40 and a p-value of 0.177. This indicates that, at the 5% significance level, PC1 is not a significant predictor of Pathogen Richness, as the p-value is greater than 0.05. The model explains only 8.92% of the variance in Pathogen Richness (\$R\^2\$ = 0.08924), which is not a large amount, and the F-statistic of 1.96 with a p-value of 0.1769 further confirms that the model is not a good fit.

In the second and third models, where Pathogen Richness is predicted by Wing Chord, the coefficient for Wing Chord is 2.2607, with a standard error of 0.9686, resulting in a t-value of 2.334 and a p-value of 0.0301. This indicates that Wing Chord is a significant predictor of Pathogen Richness at the 5% significance level. These models explain 21.41% of the variance in Pathogen Richness (\$R\^2\$ = 0.2141), which is higher than the PC1 model but still not very large. The F-statistic of 5.448 with a p-value of 0.03014 further confirms that the model is a better fit than the PC1 model but still only explains a small proportion of the variance in Pathogen Richness.

In conclusion, Wing Chord is a significant predictor of Pathogen Richness, whereas the first principal component (PC1) is not. However, both models explain a relatively small amount of variance in Pathogen Richness, indicating that other factors not included in these models are likely important in predicting pathogen richness.

-   Fit a multiple linear regression model with response variable **`PathRich`** and predictor variables equal to the first two principal components from Question 16. Compare this model with the multiple linear regression model in Question 13. [Use R functions **`lm`** and **`summary`**.]

```{r}

# Extract the principal component scores
pc1_scores <- pca_result$x[, 1]
pc2_scores <- pca_result$x[, 2]

# Fit a linear model to each relationship for principal components
fit_all_PC <- lm(chickadee_clean_rows$PathRich ~ pc1_scores + pc2_scores)

# Compare summaries
summary(fit_all_PC)
summary(fit_all)

```

We find that the multiple linear regression model using the first two principal components is not able to explain the variance in the entire dataset, as the p-value is greater than the alpha level of 0.05, while the multiple linear regression model using the variables is able to.

Let us do the same for the feather group:

```{r}

# Extract the principal component scores
pc1_scores <- pca_result$x[, 1]
pc2_scores <- pca_result$x[, 2]

# Fit a linear model to each relationship for principal components
fit_all_PC <- lm(chickadee_clean_rows$PathRich ~ pc1_scores + pc2_scores)

# Compare summaries
summary(fit_all_PC)
summary(fit_all)

```

In this study, we fit a multiple linear regression model with Pathogen Richness as a response variable and predictor variables equal to the first two principal components, and compared the model with the multiple linear regression model with the morphological features as predictor variables.

In the study of the model with PC1 and PC2, PC1 has a coefficient of 2.099 and a p-value of 0.0781, indicating marginal significance. On the other hand, PC2 has a coefficient of 7.840 and a p-value of 0.000684, which is highly significant. The overall model explains 51.11% of the variance in Pathogen Richness ($R^2$ = 0.5111) and is statistically significant, with an F-statistic of 9.933 and a p-value of 0.001115. This suggests that both the first and the second principal components contribute to explaining pathogen richness in the data, with PC2 having a stronger effect than PC1.

In the study of the Multiple Linear Regression Model with Original Variables, Tarsus Length is highly significant with a p-value of 0.00369, while the other variables are not significant. The model explains 54.76% of the variance in Pathogen Richness ($R^2$ = 0.5476) and is statistically significant, with an F-statistic of 5.144 and a p-value of 0.006673.

Both models are statistically significant, but the model with the original variables (Wing Chord, Bird Weight, Tail Length, Tarsus Length) has a slightly higher $R^2$ (54.76%) compared to the model with PC1 and PC2 (51.11%).

In summary, using the first two principal components provides a lower dimensional, but nearly equally effective way of explaining variance in Pathogen Richness compared to using the original four variables. However, then the model with the original variables provides detail of biological features.

As the first principal component was not found to be statistically significant in prediction with linear regression, let us test the second principal component:

```{r}

# Fit a linear model to each relationship for principal components
fit_PC2 <- lm(chickadee_clean_rows$PathRich ~ pc2_scores)

# Compare summaries
summary(fit_PC2)

```

The F-statistic is 14.6 with a p-value of 0.00107, below the alpha level of 0.05. We reject the null hypothesis and conclude from this data that this model is statistically significant in explaining the variance in the response variable, pathogen richness. The predictor variable, the second principal component, has a t-value of 3.82, below the alpha level of 0.05. We conclude that the second principal component is statistically significant in predicting pathogen richness. The multiple R-squared value is 0.4219, and this suggests that approximately 42.19% of the variability in pathogen richness is explained by the second principal component.

While the first principal component captured more of the variance in the predictor variables, this evidence demonstrates that this does not necessarily relate to how well the component predicts the response variable. While counter-intuitive at first glace - the second principal component in this case was superior to predicting pathogen richness.

-   Apply metric multidimensional scaling (MDS) to the dissimilarities data in the **`ChickadeeDissimilarities.csv`** file. [Use R function **`cmdscale`** to perform the metric MDS and use function **`ggplot`** to create a scatterplot that projects the data onto the first two principal coordinates. Then use the **`shape`** aesthetic to first mark the points by **`Habitat`** and then by **`Source`**.] Does the composition of the microbial communities appear to be related to **`Habitat`** or **`Source`**?

```{r}

# Microbial community composition data for 2607 taxa was also used to calculate Bray Curtis dissimilarities between the 47 sites
distChickadee <- read.csv("ChickadeeDissimilarities.csv", row.names=1)
distChickadee[1:6, 1:6]

# clustered heatmap
pheatmap(distChickadee[1:12, 1:12], cluster_rows = TRUE,
treeheight_row = 0.0001, treeheight_col = 0.8,
fontsize_col = 8, cellwidth = 13, cellheight = 13)

# Classical (metric) multidimensional scaling (MDS), also known as principal coordinates analysis
MDSChickadee <- cmdscale(distChickadee, eig = TRUE)

# Create a plotbar function to plot the eigenvalues in a scree plot.
plotbar <- function(res, m = 9) {
ggplot(data.frame(list(eig = res$eig[seq_len(m)],
k = seq(along = res$eig[seq_len(m)]))),
aes(x = k, y = eig)) +
scale_x_discrete("k", limits = factor(seq_len(m))) +
theme_minimal() +
geom_bar(stat="identity", width=0.5, color="orange",
fill="pink")
}

plotbar(MDSChickadee, m = 5)

# Project the cities onto the first two coordinates created from the distances.
MDSChick <- data.frame(list(PCo1 = MDSChickadee$points[, 1],
PCo2 = MDSChickadee$points[, 2],
labs = rownames(MDSChickadee$points)))
ggplot(MDSChick, aes(x = PCo1, y = PCo2, label = labs)) +
geom_point(color = "red") +
#xlim(-1950, 2000) +
#ylim(-1150, 1200) +
coord_fixed() +
geom_text_repel(size = 4, max.overlaps = 100)

#To re-orient the “map” so north is at the top and west is on the left, reverse the signs of the principal coordinates:
ggplot(MDSChick, aes(x = -PCo1, y = -PCo2, label = labs)) +
geom_point(color = "red") +
coord_fixed() +
geom_text_repel(size = 4, max.overlaps = 100)

# Merge the datasets
MDSChick_merged <- merge(MDSChick, chickadeeData, by.x = "labs", by.y = "Site")
print(MDSChick_merged)

# By Habitat
ggplot(MDSChick_merged, aes(x = PCo1, y = PCo2)) +
  geom_point(aes(shape = Habitat)) +
  coord_fixed() +
  scale_shape_manual(values = c(16, 17, 18))

# Zoom in
ggplot(MDSChick_merged, aes(x = PCo1, y = PCo2)) +
  geom_point(aes(shape = Habitat)) +
  xlim(-0.25, 0.25) +
  ylim(-0.25, 0.25) +
  coord_fixed() +
  scale_shape_manual(values = c(16, 17, 18))

# By Source
ggplot(MDSChick_merged, aes(x = PCo1, y = PCo2)) +
  geom_point(aes(shape = Source)) +
  coord_fixed() +
  scale_shape_manual(values = c(16, 17))

# Zoom in
ggplot(MDSChick_merged, aes(x = PCo1, y = PCo2)) +
  geom_point(aes(shape = Source)) +
  xlim(-0.25, 0.25) +
  ylim(-0.25, 0.25) +
  coord_fixed() +
  scale_shape_manual(values = c(16, 17))

```

In this study, we applied metric multidimensional scaling (MDS) to the dissimilarities dataset to assess if the composition of the microbial communities appear to be related more to Habitat or Source. Upon visual inspection of the MDS, microbial community composition appears to be more closely associated with Source, as the different categories of Source are more closely clustered.

-   Apply nonmetric multidimensional scaling (NMDS) to the dissimilarities data in the **`ChickadeeDissimilarities.csv`** file. [Use R function **`metaMDS`** to perform the NMDS and use function **`ggplot`** to create a scatterplot that projects the data onto the first two NMDS axes. Then use the **`shape`** aesthetic to first mark the points by **`Habitat`** and then by **`Source`**.] Does the composition of the microbial communities appear to be related to **`Habitat`** or **`Source`**?

```{r echo=FALSE}

# Nonmetric Multidimensional Scaling (NMDS)

# Recall that NMDS is more robust as it does not use metric distances, but it is more computationally intensive

# Create a function to conduct a nonmetric multidimensional scaling (NMDS) by running the metaMDS function (in the vegan package) multiple times for a range of possible values for k (the number of dimensions) and recording the stress values (a measure of goodness of fit; the lower the better):

nmds.stress <- function(x, sim = 100, kmax = 4) {
sapply(seq_len(kmax), function(k)
replicate(sim, metaMDS(x, k = k, autotransform = FALSE)$stress))
}

stress <- nmds.stress(distChickadee, sim = 100)

# Look at boxplots of the results as a diagnostic plot to choose k:
dfstr <- melt(stress, varnames = c("replicate","dimensions"))
ggplot(dfstr, aes(y = value, x = dimensions, group = dimensions)) +
geom_boxplot()

# Compare the observed distances and their approximations using a Shepard plot for k = 2:
nmdsk2 <- metaMDS(distChickadee, k = 2, autotransform = FALSE)
stressplot(nmdsk2, pch = 20)

# Plot the different colors using the first two NMDS axes and notice the results are similar to the MDS solution in this case:

dfnmdsk2 <-
data.frame(list(NmMDS1 = nmdsk2$points[,1],
NmMDS2 = nmdsk2$points[,2],
Site = rownames(distChickadee)
))

# Merge the two data frames by the common column
merged_df <- merge(dfnmdsk2, chickadeeData, by = "Site")

# Plotting by Habitat
ggplot(merged_df, aes(x = NmMDS1, y = NmMDS2)) +
  geom_point(aes(colour = Habitat), size = 4) +
  geom_text_repel(aes(label = Site), size = 3, max.overlaps = 100)

# Plotting by Source
ggplot(merged_df, aes(x = NmMDS1, y = NmMDS2)) +
  geom_point(aes(colour = Source), size = 4) +
  geom_text_repel(aes(label = Site), size = 3, max.overlaps = 100)


```

In this study, we applied non-metric multidimensional scaling (NMDS) to the dissimilarities dataset to assess if the composition of the microbial communities appear to be related more to Habitat or Source.

The Shepard plot suggests that both the linear and non-metric fits are excellent fits, and indicates that the lower-dimensional representation of the data is capturing almost all of the dissimilarity structure in the original high-dimensional data. The higher $R^2$ value in the non-metric Fit suggests that the NMDS solution is a slightly better model, strictly considering $R^2$.

From these scatter plots, the composition of the microbial communities appear to be related more to Source, rather than Habitat, as the different categories of Source are more closely clustered.

## 6. Statistical Inference - Estimation (if applicable)

### Point Estimation

-   Compute a single value that estimates the parameter of interest.

### Interval Estimation

-   Compute a confidence interval that contains the parameter with a specific level of confidence.

## 7. Model Validation

### Assumptions Checking

-   Check whether the assumptions of the chosen model are met.

### Goodness-of-fit

-   Evaluate how well the model fits the data.

### Residual Analysis

-   Analyze residuals to understand the variance unexplained by the model.

### Cross-Validation

-   Use techniques like k-fold cross-validation to ensure model stability and to prevent overfitting.

## 8. Interpretation

### Prediction

-   How will predictions be generated, validated, and used?

### Results Interpretation

-   Interpret the results in the context of the problem.

### Limitations

-   Discuss any limitations or assumptions in the analysis.

## 9. Communcation

### Report Writing

-   Write a clear and concise report or paper that details the analysis.

While a complex study may have multiple objectives, hypotheses, and conclusions, you can have an overall discussion and conclusion, reporting a series of key findings:

1.  **General Summary**: A brief synopsis of the study, including the aim and the methods employed.

2.  **Key Findings**: A list or subsections detailing the primary conclusions that can be drawn for each hypothesis or research question. This section may contain:

    -   Conclusions about each variable analyzed

    -   Conclusions about each hypothesis tested

    -   Any unexpected findings

3.  **Interpretations and Implications**: For each key finding, what is the broader significance? How do these findings fit in with pre-existing literature or common understanding?

4.  **Limitations**: Acknowledge any limitations that might influence the interpretation of these conclusions.

5.  **Recommendations for Future Research**: Based on the conclusions and limitations, what might future studies aim to accomplish?

6.  **Overall Conclusion**: If possible, try to synthesize the various findings into a broader takeaway. While this may not serve as a 'single' conclusion, it can still provide a unified perspective on what the research contributes to the field.

7.  **Policy or Practical Implications**: If applicable, how should the findings be used in a real-world context?

8.  **Closing Remarks**: Any other final thoughts, including the overall importance of the work.

### Visualization Tools

-   Depending on the audience, create interactive dashboards or other visualization tools to make results accessible and understandable.
-   Based on the findings of the analysis, we can find the most interesting features to use for our visualization filters, as well as patterns, anomalies, trends, estimations, and predictions.

### Presentation

-   Present the findings to stakeholders or peers.
-   The goal may be research-oriented, to present findings, and to serve as a foundation for further research, or business--oriented, where the results should guide decision-making.

## 10. Ethical Considerations

-   Always ensure that the data and methods used adhere to ethical standards, especially if the data contains personal information. Consider privacy, consent, potential biases in the data, and the implications of your analysis and predictions.

## References

1.  www.tru.ca, Thompson Rivers University. "BIOL 4001: Biostatistics." *Thompson Rivers University*, <http://www.tru.ca/distance/courses/biol4001.html.> Accessed 20 Aug. 2023.

2.  *Introduction to R*. <https://www.zoology.ubc.ca/~bio501/R/workshops/workshops-intro.html.> Accessed 20 Aug. 2023.

3.  *Resources for The Analysis of Biological Data*. <https://whitlockschluter3e.zoology.ubc.ca/index.html.> Accessed 20 Aug. 2023.
