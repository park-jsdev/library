---
title: "R Notebook"
output: html_notebook
---

# Chickadee Pathogen Data Statistical Analysis

## TRU 4001 - Biostatistics - Final Project

## Introduction

This is a personal notebook which accompanies the final project for Thompson Rivers University's Biology 4001, Biostatistics taught by Professor Iain Pardoe. The submission is a report which in the style of a research paper in biology.

This notebook includes the task requirements, as well as other statistical techniques which may be useful to carry out and document. The notebook shall serve as a general guideline and template for statistical analyses for future work.

## 1. Problem Definition

### Problem Space

Data from nest boxes at 47 mountain chickadee sites was collected to examine microbial community compositions associated with chickadees in urban, semi-urban, and rural environments. DNA sequencing was used to determine the relative abundance of different microbial taxa present in swabs from either chickadee nests or feathers in nest boxes in these three habitat types. Nest boxes were set up to encourage nesting in the sample sites. For the feather data, physical characteristics of the birds were recorded. The data was also used to determine two different measures of microbial species richness (alpha diversity) at each site.

From the description, it appears that we are interested in microbial community compositions, particularly pathogenic bacteria species, and their relationship with features of mountain chickadees.

### Type of Problem

-   Determine whether the problem is a descriptive study, hypothesis testing, estimation, prediction, etc.

There are various problems in this task, including descriptive studies, hypothesis testing, estimation, and prediction.

### Task/Question/Hypothesis

-   Clearly Define the questions to be answered or the hypotheses to be tested.

    #### (Graded)

    \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

-   Summarize the data in **`ChickadeeData.csv`** numerically.

-   Summarize the data in **`ChickadeeData.csv`** graphically.

-   Use a two-sample *t*-test to determine whether the mean abundance of bacteria identified as genus *Escherichia/Shigella* differs significantly between nests and feathers. [Consider transforming variable **`EscShi`** and use R function **`t.test`**. Be careful when applying the natural logarithm transformation to data containing zeros since ln(0) is undefined. The usual way around this is to calculate ln(y+1) instead of ln(y).]

-   Use a Mann-Whitney U-test (Wilcoxon rank sum test) to determine whether the population distribution of the abundance of bacteria identified as genus *Escherichia/Shigella* differs significantly between nests and feathers. [Use R function **`wilcox.test`**.]

-   Use a two-sample *t*-test to determine whether the mean abundance of bacteria identified as genus *Enterococcus* differs significantly between nests and feathers. [Consider transforming variable **`Entero`** and use R function **`t.test`**.]

-   Use a Mann-Whitney U-test (Wilcoxon rank sum test) to determine whether the population distribution of the abundance of bacteria identified as genus *Enterococcus* differs significantly between nests and feathers. [Use R function **`wilcox.test`**.]

-   Use analysis of variance to determine whether mean pathogen richness is related to habitat. [Use R functions **`lm`** and **`anova`**.]

-   Use a Kruskal-Wallis test to determine whether mean pathogen richness is related to habitat. [Use R function **`kruskal.test`**.]

-   Use the Tukey-Kramer method to which habitats differ with respect to mean pathogen richness. [Use R functions **`emmeans`** and **`contrast`**.]

-   Use contingency table analysis to determine whether community richness on feathers is independent of mountain chickadees sex? [Use R function **`filter`** in the **`dplyr`** package to subset the data frame to retain only feather swabs, then use R functions **`table`** and **`chisq.test`**.]

-   Use simple linear regression to determine which of **`WingChord`**, **`BirdWeight`**, **`TailLen`**, or **`TarsusLen`** is most linearly associated with pathogen richness on feathers. [Use R functions **`lm`** and **`summary`**.]

-   For the simple linear regression model selected in Question 11, investigate whether there are any outliers. An outlier in the context of linear regression is an observation with an extreme difference between the observed response value and the predicted response value from the model. Use the **`filter`** function to create a new data frame that excludes the most extreme outlier and refit the simple linear regression model. Report the results for the model fit to the data frame excluding the outlier and use this data frame to answer Questions 13-18.

-   Find the best multiple linear regression model for predicting pathogen richness on feathers from two predictors out of **`WingChord`**, **`BirdWeight`**, **`TailLen`**, and **`TarsusLen`**. [Use R functions **`lm`** and **`summary`**.]

-   Use a two-sample *t*-test to determine whether mean pathogen richness on feathers differs significantly between male and female birds. [Use R function **`t.test`**.]

-   Starting from the simple linear regression model in Question 12, use analysis of covariance to investigate whether the linear association in the model differs for male and female birds. [Use R functions **`lm`** and **`summary`**.]

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

-   Apply principal component analysis to the variables **`WingChord`**, **`BirdWeight`**, **`TailLen`**, and **`TarsusLen`**. [Use R functions **`scale`**, **`prcomp`**, and **`summary`**. Also, summarize the principal component loadings and use R function **`fviz_pca_ind`** with argument **`habillage`** to visualize the results and colour the observations by bird sex.]

-   Fit a simple linear regression model with response variable **`PathRich`** and predictor variable equal to the first principal component from Question 16. Compare this model with the simple linear regression model in Question 12. [Use R functions **`lm`** and **`summary`**.]

-   Fit a multiple linear regression model with response variable **`PathRich`** and predictor variables equal to the first two principal components from Question 16. Compare this model with the multiple linear regression model in Question 13. [Use R functions **`lm`** and **`summary`**.]

-   Apply metric multidimensional scaling (MDS) to the dissimilarities data in the **`ChickadeeDissimilarities.csv`** file. [Use R function **`cmdscale`** to perform the metric MDS and use function **`ggplot`** to create a scatterplot that projects the data onto the first two principal coordinates. Then use the **`shape`** aesthetic to first mark the points by **`Habitat`** and then by **`Source`**.] Does the composition of the microbial communities appear to be related to **`Habitat`** or **`Source`**?

-   Apply nonmetric multidimensional scaling (NMDS) to the dissimilarities data in the **`ChickadeeDissimilarities.csv`** file. [Use R function **`metaMDS`** to perform the NMDS and use function **`ggplot`** to create a scatterplot that projects the data onto the first two NMDS axes. Then use the **`shape`** aesthetic to first mark the points by **`Habitat`** and then by **`Source`**.] Does the composition of the microbial communities appear to be related to **`Habitat`** or **`Source`**?

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

## 2. Data Collection and Preprocessing

### Data Source

-   Identify the sources of data, whether it is from an experiment, survey, existing dataset, etc.

The data in the **`ChickadeeData.csv`** file consist of the following variables:

-   **`Site`** = Name of the site

-   **`Habitat`** = Whether the nest box is in an urban, semi-urban, or rural habitat

-   **`Source`** = Whether the swab was taken from a nest or a feather

-   **`EscShi`** = Abundance of pathogenic bacteria identified as genus *Escherichia/Shigella*

-   **`Entero`** = Abundance of pathogenic bacteria identified as genus *Enterococcus*

-   **`CommRich`** = Categorical measure of alpha diversity equal to "high" if the number of unique bacterial species present in the swab exceeds 400, or equal to "low" otherwise

-   **`PathRich`** = Quantitative measure of alpha diversity equal to the number of unique potentially pathogenic bacteria species present in the swab

-   **`WingChord`** = Measure of bird wing size (for feather swabs only)

-   **`BirdWeight`** = Measure of bird weight (for feather swabs only)

-   **`TailLen`** = Measure of bird tail length (for feather swabs only)

-   **`TarsusLen`** = Measure of bird tarsus length (for feather swabs only)

-   **`BirdSex`** = Sex of the bird (for feather swabs only)

Microbial community composition data for 2607 taxa was also used to calculate Bray Curtis dissimilarities between the 47 sites; these are in the **`ChickadeeDissimilarities.csv`** file.

### Data Cleaning

-   Preprocess the data to handle missing values, outliers, or other anomalies.

As the dataset was provided as an assignment, no preprocessing is required. However, let us do a basic check for null values:

```{r}
# Read the data
chickadeeData <- read.csv("ChickadeeData.csv")
dissimilaritiesData <- read.csv("ChickadeeDissimilarities.csv")

# Check for Missing Data in the Entire Dataset
sum(is.na(chickadeeData))

# Check for Missing Data Column-wise
colSums(is.na(chickadeeData))

# Check for Missing Data Row-wise
rowSums(is.na(chickadeeData))

# Visualizing Missing Data
library(visdat)
vis_miss(chickadeeData)


# Now for dissimilarities data

# Check for Missing Data in the Entire Dataset
sum(is.na(dissimilaritiesData))

# Check for Missing Data Column-wise
colSums(is.na(dissimilaritiesData))

# Check for Missing Data Row-wise
rowSums(is.na(dissimilaritiesData))

# Visualizing Missing Data
vis_miss(dissimilaritiesData)

```

It appears that 15.1% of the chickadee dataset is missing, while there is no null data in the dissimilarities dataset.

For now, we will leave it as we develop a better understanding of the data and the problem.

### Experimental Design Considerations

-   Designing Effective Experiments: consider (a) reducing bias in estimating and testing treatment effects, and (b) reducing the effects of sampling error.

-   Topics in experimental design include randomized controlled trials, control groups, treatment groups, and experimental controls.

-   Reduce bias: Use Simultaneous control group, randomization, and blinding.

-   Reduce the influence of sampling error: Replication, balance, blocking, and extreme treatments.

-   If you can't do experiments: Match and adjust.

-   Sample size: Plan for precision, power, and data loss.

-   A priori tests or analyses.

### Feature Engineering

-   Deriving new variables that might be relevant for analysis.

### Data Transformation

-   Such as normalization, standardization, or logarithmic transformation if required.

## 3. Exploratory Data Analysis

-   Exploratory Data Analysis (EDA) is an essential step in understanding the data, identifying patterns, spotting anomalies, and developing an intuition about the relationships between variables.

### Data Inspection

-   The first step should be to open and inspect the dataset (even in a spreadsheet). View the first few lines and familiarize yourself with the variable names.

-   A good first goal is to find a plot type that clearly and efficiently visualizes the patterns in the data, especially the differences among groups.

Let us open and inspect the data in excel, to get a first glance. The variables and the data are already described in the assignment.

### Setup

```{r}
# setwd("C:\\Users\\JP\\Desktop\\RECENT\\Biology\\BIOL 4001 - Biostatistics\\Final")
library(ggplot2)
library(dplyr)
library(emmeans)
library(GGally)
library(factoextra)
library(ggrepel)
library(vegan)
library(Hmisc)
theme_set(theme_classic())

```

### Summary Statistics

-   Measures of Central Tendency: Mean, median, and mode.

-   Measures of Spread: Variance, standard deviation, range, interquartile range (IQR).

-   Measures of Shape: Skewness (asymmetry) and kurtosis (tailedness).

-   Percentiles: Quantiles including the quartiles.

-   Correlation: Correlation coefficients to measure linear relationships between variables.

-   Summary Statistics by Group.

-   Summarize the data in **`ChickadeeData.csv`** numerically.

```{r}
# Summarize data
summary(chickadeeData)
head(chickadeeData)

# See column names
names(chickadeeData)

# Check unique values of a specific column
unique(chickadeeData$Source)

# Detailed summary of dataframe
str(chickadeeData)

# Summarize each variable using Hmisc
describe(chickadeeData)

# Use a table to display example categorical variable
chickadeeTableEscShi <- table(chickadeeData$EscShi)
chickadeeTableEscShi

chickadeeTableEntero <- table(chickadeeData$Entero)
chickadeeTableEntero

```

### Visualizations

-   Histograms: To understand the distribution of a single variable.

-   Scatter Plots: To visualize relationships between two continuous variables.

-   Box Plots: To see the spread and skewness across categories.

-   Heatmaps: For visualizing correlation matrices or two-way frequency tables.

-   Pair Plots: A set of scatter plots for all pairs of variables to see relationships and distributions.

-   Time Series Plots: If the data is a time series, to visualize trends and seasonality.

-   Summarize the data in **`ChickadeeData.csv`** graphically.

```{r}

# Factor the categorical only

# Factor pathogen data variables
# EscShi
chickadeeData$EscShi_ordered <- factor(chickadeeData$EscShi,
  levels = names(sort(chickadeeTableEscShi,
                 decreasing = TRUE)))

table(chickadeeData$EscShi_ordered)

# Entero
chickadeeData$Entero_ordered <- factor(chickadeeData$Entero,
  levels = names(sort(chickadeeTableEntero,
                 decreasing = TRUE)))

table(chickadeeData$Entero_ordered)

# Visualize frequency distributions of single variables

# Bar charts for categorical variables

# Habitat
ggplot(data = chickadeeData, aes(x = Habitat)) +
geom_bar(stat = "count") +
labs(x = "Habitat", y = "Frequency") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Source
ggplot(data = chickadeeData, aes(x = Source)) +
geom_bar(stat = "count") +
labs(x = "Source", y = "Frequency") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))

# CommRich
ggplot(data = chickadeeData, aes(x = CommRich)) +
geom_bar(stat = "count") +
labs(x = "Alpha Diversity", y = "Frequency") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))

# BirdSex
ggplot(data = chickadeeData, aes(x = BirdSex)) +
geom_bar(stat = "count") +
labs(x = "Sex", y = "Frequency") +
theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Histograms for numerical variables

# EscShi
ggplot(data = chickadeeData, aes(x = EscShi)) +
geom_histogram(col = "black", binwidth = 50,
boundary = 0, closed = "left") +
labs(x = "EscShi", y = "Frequency")

# Entero
ggplot(data = chickadeeData, aes(x = Entero)) +
geom_histogram(col = "black", binwidth = 10,
boundary = 0, closed = "left") +
labs(x = "Entero", y = "Frequency")

# PathRich
ggplot(data = chickadeeData, aes(x = PathRich)) +
geom_histogram(col = "black", binwidth = 4,
boundary = 0, closed = "left") +
labs(x = "Alpha Diversity", y = "Frequency")

# WingChord
ggplot(data = chickadeeData, aes(x = WingChord)) +
geom_histogram(col = "black", binwidth = 1,
boundary = 0, closed = "left") +
labs(x = "Wing Size", y = "Frequency")

# BirdWeight
ggplot(data = chickadeeData, aes(x = BirdWeight)) +
geom_histogram(col = "black", binwidth = 0.5,
boundary = 0, closed = "left") +
labs(x = "Weight", y = "Frequency")

# TailLen
ggplot(data = chickadeeData, aes(x = TailLen)) +
geom_histogram(col = "black", binwidth = 1,
boundary = 0, closed = "left") +
labs(x = "Tail Length", y = "Frequency")

# TarsusLen
ggplot(data = chickadeeData, aes(x = TarsusLen)) +
geom_histogram(col = "black", binwidth = 0.2,
boundary = 0, closed = "left") +
labs(x = "Tarsus Length", y = "Frequency")



# Relationship between 2 variables

# Box Plot for numerical variable vs categorical variable
ggplot(chickadeeData, aes(x=BirdSex, y=TarsusLen)) + geom_boxplot()

# Scatter Plots
ggplot(chickadeeData,   
  aes(x = BirdWeight, 
  y = EscShi)) +
  geom_point()

ggplot(chickadeeData,   
  aes(x = TarsusLen, 
  y = PathRich)) +
  geom_point()

# Strip Chart
ggplot (data = chickadeeData, aes(x = WingChord, y = Entero)) +
geom_jitter(shape = 1, size = 2, width = 0.15) +
labs(x = "Wing Size", y = "Entero")

# Violin Plot
ggplot(data = chickadeeData, aes(y = BirdWeight, x = TailLen)) +
geom_violin() +
labs(x = "Tail Length", y = "BirdWeight") +
stat_summary(fun = mean, geom = "point")


```

Some initial exploration of the variables have given us some familiarity with the dataset.

### Probability (Distributions)

-   Explore and identify the probability distributions of variables, obtain probability mass and density functions.

-   Common Discrete Probability Distributions: Binomial, Discrete Uniform, Poisson.

-   Create probability table for categorical variables.

-   Create probability mass functions (pmf) for discrete probability distributions.

-   Common Continuous Probability Distributions: Normal, Continuous, Log-Normal, Exponential.

-   Create probability density functions (pdf) and/or cumulative density functions (cdf) for continuous probability distributions.

-   You can find the expected value and standard deviation of a probability distribution if you have the formula, sample, or probability table of the distribution (which are used in tests below).

### Dimensionality Reduction

-   Techniques like t-SNE in addition to PCA, especially for visualizing high-dimensional data.

### Other Techniques

-   Missing Value Analysis: Identifying and analyzing missing data.

-   Outlier Detection: Methods to detect and analyze unusual observations.

-   Categorical Data Analysis: Frequency tables, bar charts, pie charts for categorical variables.

-   Multivariate Analysis: Techniques like Principal Component Analysis (PCA) to understand the relationships among multiple variables.

-   Cross-Tabulations: Also known as contingency tables; useful for understanding the relationship between two categorical variables.

-   Spatial Analysis: If the data has geographical attributes, spatial visualization, and analysis might be essential.

-   Text Analysis: If the dataset contains text, basic text mining techniques might be applicable.

### Initial Tests

-   Normality Tests: Checking if a variable follows a normal distribution.

-   Homogeneity of Variances: Testing if the variances are equal across groups.

### Relationships

-   Correlation: Understand statistical association between variables.

-   Covariance: Understanding how two variables change together.

-   Regression Analysis/Plots: Simple linear regression to visually understand relationships.

-   Effect Size: Understanding the magnitude of relationships between variables.

### Contingency Analysis

-   Association: Understanding if there is an association between the categories of different variables.

-   Independence Testing: Statistical tests like the Chi-Squared Test for Independence can be applied to contingency tables to determine if there is a significant association between the variables.

-   Conditional Probabilities: You can calculate conditional probabilities to understand how the probability of one event changes given the knowledge of another event.

-   Comparison Across Groups: If you have more than two categorical variables, you can explore how the relationship between two variables may differ across the levels of a third variable.

-   Marginal Distribution: You can analyze the marginal distribution of one variable irrespective of the others. This gives insights into the overall distribution of a particular variable.

-   Expected Frequencies: In some cases, you might want to compare observed frequencies in the contingency table with expected frequencies under some statistical model. This can give insights into how well a given model fits your data.

-   Use contingency table analysis to determine whether community richness on feathers is independent of mountain chickadees sex? [Use R function **`filter`** in the **`dplyr`** package to subset the data frame to retain only feather swabs, then use R functions **`table`** and **`chisq.test`**.

```{r}

# Confirm the column to be filtered
unique(chickadeeData$Source)

# Filter df for Source = feather
df_feather <- filter(chickadeeData, Source == 'feather')
df_feather

# Check the order of the categories
chickadeeData$CommRich
unique(chickadeeData$CommRich)
# They are already ordered

# Order the categories as desired by turning into a factor variable (if needed. This is useful for more than 2 categories)
CommRich_BirdSex_table$CommRich <-
factor(CommRich_BirdSex_table$CommRich,
levels = c("low", "high"))

# Create 2x2 Contingency Table for community richness and sex
CommRich_BirdSex_table <- table(df_feather$CommRich, df_feather$BirdSex)
CommRich_BirdSex_table
str(CommRich_BirdSex_table)

# Create a mosaic plot to visualize the data
par(pty = "s") # makes a square plot
mosaicplot(t(CommRich_BirdSex_table), col = c("firebrick", "goldenrod1"),
cex.axis = 1, main = "",
sub = "Infection status", ylab = "Relative frequency")

# Conduct a Chi-squared Test of Independence of Two Categorical Variables
Xsq <- chisq.test(CommRich_BirdSex_table, correct = FALSE)
Xsq
```

As the p-value is less than the alpha level of 0.05, there is not enough evidence to conclude that there is an association between community richness and bird sex, based on the Chi-squared test of the contingency table analysis. From these results, we would fail to accept the null hypothesis of independence of the variables.

Simply said, there is no reason to assume that the pathogen community richness on feathers would differ due to the birds' sex.

## 4. Model Specification

### Statistical Model

-   Choose an appropriate statistical model that aligns with the type of data and research question.

### Estimator

-   Decide on the method of estimation (e.g., Maximum Likelihood, Least Squares, etc.).

### Hyperparameters

-   If you're working with models that require hyperparameter tuning, choose the appropriate values or ranges and methods (like grid search or random search).

## 5. Statistical Inference - Hypothesis Testing (if applicable)

### Null and Alternative Hypotheses

-   Define the hypotheses to be tested.

### Test Statistic

-   Decide on the level of significance (e.g., α = 0.05).

### P-value

-   Compute the p-value to determine statistical significance.

### Conclusion

-   Make a decision to accept or reject the null hypothesis based on the p-value.

### Post-Hoc Analysis

-   Tests or Analyses that are performed after the initial hypothesis test to explore the data further, especially when the initial test indicates a significant result.

Note that in R, statistical tests are performed through functions and summarized for you, rather than having to manually implement them (while you can calculate them by hand).

The statistician should handle:

-   The interpretation of the tests. A p-value by itself does not "prove" anything.

-   Underlying assumptions that built-in functions do not automatically check for.

-   Choice of test: ensure that the appropriate test for the data and research question is applied.

-   Data pre-processing: the data must be processed such that the test can be ran on it, handling issues like outliers, missing data, or necessary transformations.

-   Multiple comparisons: generally, research questions will involve comparing the results of multiple tests on the data, and forming an interpretation.

Let us perform the tests of the assignment.

-   Use a two-sample *t*-test to determine whether the mean abundance of bacteria identified as genus *Escherichia/Shigella* differs significantly between nests and feathers. [Consider transforming variable **`EscShi`** and use R function **`t.test`**. Be careful when applying the natural logarithm transformation to data containing zeros since ln(0) is undefined. The usual way around this is to calculate ln(y+1) instead of ln(y).]

As we saw above, EscShi data appears to be Log-normal (having a right-skewed distribution), and could benefit from a natural log transformation. Let us visualize this.

```{r}
# EscShi untransformed
ggplot(data = chickadeeData, aes(x = EscShi)) +
geom_histogram(col = "black", binwidth = 50,
boundary = 0, closed = "left") +
labs(x = "EscShi", y = "Frequency")

# Natural Log transformation + 1 (to handle zeroes)
EscShi_transformed <- log(chickadeeData$EscShi + 1)

# Transformed EscShi histogram
ggplot(data = chickadeeData, aes(x = EscShi_transformed)) +
geom_histogram(col = "black", binwidth = 0.5,
boundary = 0, closed = "left") +
labs(x = "EscShi", y = "Frequency")
```

The transformed data is indeed easier to visualize. From visual inspection, the distribution appears to be approximately normally distributed. Let us assume that the variance within the groups are equal and perform the t-test.

```{r}

# Two sample t-test, assuming equal group variance 
t.test(EscShi ~ Source, data = chickadeeData, var.equal = TRUE)

# Two sample t-test of transformed data, assuming equal group variance
t.test(EscShi_transformed ~ Source, data = chickadeeData, var.equal = TRUE)

```

Based on the test, there is evidence to reject the null hypothesis. The test also shows that there is a higher mean abundance of bacteria identified as genus *Escherichia/Shigella* in the feather group.

-   Use a Mann-Whitney U-test (Wilcoxon rank sum test) to determine whether the population distribution of the abundance of bacteria identified as genus *Escherichia/Shigella* differs significantly between nests and feathers. [Use R function **`wilcox.test`**.]

As we desire to know if the results of the log-normal test would hold to the original population, we will carry out a Mann-Whitney U-test, which can be used in place of the two-sample t-test when the normal distribution assumption of the two-sample t-test cannot be met.

The Mann--Whitney U-test compares the distributions of two groups. It does not require as many assumptions as the two-sample t-test.

Therefore, we will carry it out on the untransformed data.

```{r}

# Mann-Whitney U-Test
wilcox.test(EscShi ~ Source, data = chickadeeData)

```

Based on the results of the test, we reject the null hypothesis, and find that there is evidence that the distributions of EscShi abundance between nests and feathers differ significantly.

-   Use a two-sample *t*-test to determine whether the mean abundance of bacteria identified as genus *Enterococcus* differs significantly between nests and feathers. [Consider transforming variable **`Entero`** and use R function **`t.test`**.]

We repeat the same procedure for genus *Enterococcus* as we did for genus *Escherichia/Shigella.*

```{r}
# Entero untransformed
ggplot(data = chickadeeData, aes(x = Entero)) +
geom_histogram(col = "black", binwidth = 10,
boundary = 0, closed = "left") +
labs(x = "Entero", y = "Frequency")

# Natural Log transformation + 1 (to handle zeroes)
Entero_transformed <- log(chickadeeData$Entero + 1)

# Transformed Entero histogram
ggplot(data = chickadeeData, aes(x = Entero_transformed)) +
geom_histogram(col = "black", binwidth = 0.5,
boundary = 0, closed = "left") +
labs(x = "Entero", y = "Frequency")

# Two sample t-test of transformed data, assuming equal group variance
t.test(Entero_transformed ~ Source, data = chickadeeData, var.equal = TRUE)

```

Based on the results of the test, we reject the null hypothesis, and find that the mean abundance of *Enterococcus* differs significantly between nests and feathers as well. However, the test shows that there is a higher mean abundance of bacteria identified as genus *Enterococcus* in the nest group.

-   Use a Mann-Whitney U-test (Wilcoxon rank sum test) to determine whether the population distribution of the abundance of bacteria identified as genus *Enterococcus* differs significantly between nests and feathers. [Use R function **`wilcox.test`**.]

```{r}

# Mann-Whitney U-Test
wilcox.test(Entero ~ Source, data = chickadeeData)

```

Based on the results of the test, we reject the null hypothesis, and find that the population distribution of the abundance of *Enterococcus* differs significantly between nests and feathers.

So far, we can interpret that there is a significant difference of the abundance of bacteria between nests and feathers, but there is a higher abundance of *Escherichia/Shigella* in the feather group, while there is a higher abundance of *Enterococcus* in the nest group.

-   Use analysis of variance to determine whether mean pathogen richness is related to habitat. [Use R functions **`lm`** and **`anova`**.]

Let us first investigate if mean pathogen richness requires transformation.

```{r}
# Summarize variable
describe(chickadeeData$PathRich)

# PathRich
ggplot(data = chickadeeData, aes(x = PathRich)) +
geom_histogram(col = "black", binwidth = 4,
boundary = 0, closed = "left") +
labs(x = "Pathogen Richness", y = "Frequency")

# Shapiro-Wilk Test for normality
shapiro.test(chickadeeData$PathRich)

```

Upon visual inspection, the pathogen richness data does appear to be normally distributed, and we conclude from the Shapiro-Wilk test that there is do significant difference from a normal distribution. Therefore, we will not transform this data.

Let us perform the analysis of variance:

```{r}
# Scatter Plot with linear model
ggplot(chickadeeData, aes(x=Habitat, y=PathRich)) +
  geom_point(aes(color=Habitat), size=3) +            # Scatter plot
  geom_smooth(method='lm', aes(group=1, color=Habitat)) + # Add a linear fit, colored by Habitat
  labs(title="Relationship between Pathogen Richness and Habitat",
       x="Habitat",
       y="Pathogen Richness") +
  theme_minimal()

```

Upon visual inspection of the linear model, discounting outliers, there does appear to be a linear relationship between pathogen richness and habitat, if we order from rural to urban.

```{r}

# Simple Linear Regression
PathRich_Habitat_Regression <- lm(PathRich ~ Habitat, data = chickadeeData)
summary(PathRich_Habitat_Regression)

# Calculate a 95% Confidence interval for the slope
# confint(PathRich_Habitat_Regression, level = 0.95)

# ANOVA
anova(PathRich_Habitat_Regression)
```

The linear model confirms this, as the estimates of coefficients increases as we compare habitats. The predictors are statistically significant, as the p values are below the alpha level of 0.05.

The Multiple R-squared tells us the proportion of the variance in the dependent variable that is predictable from the independent variable(s). In this case, it is 19.34%, and while it is not high, it is non-negligible.

The F-statistic tests whether at least one predictor variable has a non-zero coefficient, and the p-value is less than alpha 0.05, meaning that habitat is a significant predictor of pathogen richness.

ANOVA essentially tests whether the model, as a whole, explains a significant amount of the variance in the dependent variable.

The p-value associated with the F-statistic is less than the alpha level of 0.05, meaning that there is a significant effect of habitat on pathogen richness.

Based on these results, we can conclude that mean pathogen richness is related to habitat. The model as a whole is statistically significant, but the Multiple R-squared value suggests that only about 19.34% of the variability in pathogen richness can be explained by habitat, so there may be other factors at play as well.

Thus, there is evidence to support that habitat is a significant predictor of pathogen richness, but it is not the only factor influencing it. Furthermore, as it is implied that habitat is categorized based on human population density, we can infer that pathogen richness increases with human population density.

-   Use a Kruskal-Wallis test to determine whether mean pathogen richness is related to habitat. [Use R function **`kruskal.test`**.]

```{r}

# Kruskal-Wallis Test
kruskal.test(PathRich ~ Habitat, data = chickadeeData)

```

The Kruskal-Wallis test is a non-parametric alternative to single factor ANOVA, and is used to test if there are statistically significant differences between the medians of three or more independent groups. Unlike ANOVA, it does not assume a normal distribution of the residuals or homogeneity of variance.

In this case, the p-value associated with the Kruskal-Wallis chi-squared test statistic is below alpha of 0.01, and we can conclude that the differences in the groups are due to random chance. From this conclusion, we have gathered evidence to support the inferences from the linear model.

-   Use the Tukey-Kramer method to which habitats differ with respect to mean pathogen richness. [Use R functions **`emmeans`** and **`contrast`**.]

```{r}

# Tukey-Kramer test
# Often used as a post-hoc analysis after a one-way ANOVA or Kruskal-Wallis test to determine which specific groups differ from each other.
pathogenPairs <- emmeans(PathRich_Habitat_Regression, specs = "Habitat")
pathogenUnplanned <- contrast(pathogenPairs, method = "pairwise",
adjust = "tukey")

pathogenUnplanned
```

Let us interpret each row.

1.  Rural vs Semi-Urban: Pathogen richness is lower in rural areas than semi-urban areas, but the p-value is greater than the alpha level of 0.05. This difference is not statistically significant.
2.  Rural vs Urban: Pathogen richness is lower in rural areas than urban areas, and the p-value is lower than the alpha level of 0.05. This difference is statistically significant.
3.  Semi-Urban vs Urban: Pathogen richness is lower in semi-urban areas than urban areas, but the p-value is greater than the alpha level of 0.05. This difference is not statistically significant.

From the Tukey-Kramer test, we can conclude that pathogen richness is significantly higher in urban areas compared to rural areas, but there are no statistically significant differences in pathogen richness between rural and semi-urban areas, or between semi-urban and urban areas based on this data.

These results support the linear regression model and Kruskal-Wallis test, reinforcing the idea that pathogen richness varies with habitat type.

-   Use simple linear regression to determine which of **`WingChord`**, **`BirdWeight`**, **`TailLen`**, or **`TarsusLen`** is most linearly associated with pathogen richness on feathers. [Use R functions **`lm`** and **`summary`**.]

```{r}

# Select the subset df for feathers
summary(df_feather)
unique(df_feather)

# Fit a linear model to each relationship
fit_WingChord <- lm(df_feather$PathRich ~ df_feather$WingChord)
fit_BirdWeight <- lm(df_feather$PathRich ~ df_feather$BirdWeight)
fit_TailLen <- lm(df_feather$PathRich ~ df_feather$TailLen)
fit_TarsusLen <- lm(df_feather$PathRich ~ df_feather$TarsusLen)

# Summarize the fits
summary(fit_WingChord)
summary(fit_BirdWeight)
summary(fit_TailLen)
summary(fit_TarsusLen)

# Alternatively, fit a multiple linear regression model
fit_all <- lm(PathRich ~ WingChord + BirdWeight + TailLen + TarsusLen, data = df_feather)
summary(fit_all)

```

The Highest R-squared value is considered the most linearly associated with the dependent variable, while the variable with the lowest p-value is the most statistically significant predictor of the dependent variable. By using a multiple linear regression model, we cannot compare the R-squared values between each of the fits, so it is preferable to fit each one separately.

Let us inspect the metrics of each fit:

-   For the simple linear regression model selected in Question 11, investigate whether there are any outliers. An outlier in the context of linear regression is an observation with an extreme difference between the observed response value and the predicted response value from the model. Use the **`filter`** function to create a new data frame that excludes the most extreme outlier and refit the simple linear regression model. Report the results for the model fit to the data frame excluding the outlier and use this data frame to answer Questions 13-18.

-   Find the best multiple linear regression model for predicting pathogen richness on feathers from two predictors out of **`WingChord`**, **`BirdWeight`**, **`TailLen`**, and **`TarsusLen`**. [Use R functions **`lm`** and **`summary`**.]

-   Use a two-sample *t*-test to determine whether mean pathogen richness on feathers differs significantly between male and female birds. [Use R function **`t.test`**.]

-   Starting from the simple linear regression model in Question 12, use analysis of covariance to investigate whether the linear association in the model differs for male and female birds. [Use R functions **`lm`** and **`summary`**.]

## 6. Statistical Inference - Estimation (if applicable)

### Point Estimation

-   Compute a single value that estimates the parameter of interest.

### Interval Estimation

-   Compute a confidence interval that contains the parameter with a specific level of confidence.

## 7. Model Validation

### Assumptions Checking

-   Check whether the assumptions of the chosen model are met.

### Goodness-of-fit

-   Evaluate how well the model fits the data.

### Residual Analysis

-   Analyze residuals to understand the variance unexplained by the model.

### Cross-Validation

-   Use techniques like k-fold cross-validation to ensure model stability and to prevent overfitting.

## 8. Interpretation

### Prediction

-   How will predictions be generated, validated, and used?

### Results Interpretation

-   Interpret the results in the context of the problem.

### Limitations

-   Discuss any limitations or assumptions in the analysis.

## 9. Communcation

### Report Writing

-   Write a clear and concise report or paper that details the analysis.

### Visualization Tools

-   Depending on the audience, create interactive dashboards or other visualization tools to make results accessible and understandable.

### Presentation

-   Present the findings to stakeholders or peers.

## 10. Ethical Considerations

-   Always ensure that the data and methods used adhere to ethical standards, especially if the data contains personal information. Consider privacy, consent, potential biases in the data, and the implications of your analysis and predictions.

## References

1.  www.tru.ca, Thompson Rivers University. "BIOL 4001: Biostatistics." *Thompson Rivers University*, <http://www.tru.ca/distance/courses/biol4001.html.> Accessed 20 Aug. 2023.

2.  *Introduction to R*. <https://www.zoology.ubc.ca/~bio501/R/workshops/workshops-intro.html.> Accessed 20 Aug. 2023.

3.  *Resources for The Analysis of Biological Data*. <https://whitlockschluter3e.zoology.ubc.ca/index.html.> Accessed 20 Aug. 2023.
